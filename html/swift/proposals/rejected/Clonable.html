

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Clonable &mdash; Swift Programming Language documentation 0.1.9 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Swift Programming Language documentation 0.1.9 documentation" href="../../index.html"/>
<style type="text/css">
  table.right { float: right; margin-left: 20px; }
  table.right td { border: 1px solid #ccc; }
</style>


  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Swift Programming Language documentation
          

          
          </a>

          
            
            
              <div class="version">
                0.1.9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">swift docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ABI.html">The Swift ABI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ARCOptimization.html">ARC Optimization for Swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../AccessControl.html">Access Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../AccessControlInStdlib.html">Scope and introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../AccessControlInStdlib.html#public"><cite>public</cite></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../AccessControlInStdlib.html#internal"><cite>internal</cite></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../AccessControlInStdlib.html#private"><cite>private</cite></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../AccessControlInStdlib.html#leading-underscore-rule">Leading Underscore Rule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Arrays.html">The Swift Array Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CallingConvention.html">The Swift Calling Convention</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DebuggingTheCompiler.html">Debugging the Swift Compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Dependency Analysis.html">Dependency Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DriverInternals.html">Driver Design &amp; Internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DriverParseableOutput.html">Parseable Driver Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ErrorHandling.html">Error Handling in Swift 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ErrorHandlingRationale.html">Error Handling Rationale and Proposal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Failable Initializers.html">Failable initializers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Generics.html">Generics in Swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GitWorkflows.html">Git Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GitWorkflows.html#svn-git-workflows">SVN -&gt; GIT Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../HighLevelSILOptimizations.html">High-Level Optimizations in SIL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Import.html">IMPORT SYNTAX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Import.html#resolving-name-clashes">RESOLVING NAME CLASHES</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Import.html#future-extensions">FUTURE EXTENSIONS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../IndexInvalidation.html">Index Invalidation Rules in the Swift Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../LibraryEvolution.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../LibraryEvolution.html#using-versioned-api">Using Versioned API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../LibraryEvolution.html#publishing-versioned-api">Publishing Versioned API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../LibraryEvolution.html#giving-up-flexibility">Giving Up Flexibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../LibraryEvolution.html#optimization">Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../LibraryEvolution.html#resilience-domains">Resilience Domains</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../LibraryEvolution.html#protocol-conformances">Protocol Conformances</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../LibraryEvolution.html#checking-binary-compatibility">Checking Binary Compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../LibraryEvolution.html#summary">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../LibraryEvolution.html#glossary">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Literals.html">Literals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../LogicalObjects.html">Logical Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Modules.html">High-Level Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Modules.html#import"><code class="docutils literal"><span class="pre">import</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Modules.html#interoperability-with-objective-c-via-clang">Interoperability with Objective-C via Clang</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Modules.html#glossary">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MutationModel.html">Immutability and Read-Only Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ObjectInitialization.html">Object Initialization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../OptimizationTips.html">Writing High-Performance Swift Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../OptimizationTips.html#enabling-optimizations">Enabling Optimizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../OptimizationTips.html#whole-module-optimizations">Whole Module Optimizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../OptimizationTips.html#reducing-dynamic-dispatch">Reducing Dynamic Dispatch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../OptimizationTips.html#using-container-types-efficiently">Using Container Types Efficiently</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../OptimizationTips.html#unchecked-operations">Unchecked operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../OptimizationTips.html#generics">Generics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../OptimizationTips.html#the-cost-of-large-swift-values">The cost of large swift values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../OptimizationTips.html#unsafe-code">Unsafe code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../OptimizationTips.html#protocols">Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../OptimizationTips.html#footnotes">Footnotes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Pattern Matching.html">Pattern Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../SIL.html">Swift Intermediate Language (SIL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../SequencesAndCollections.html">Sequences And Collections in Swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Serialization.html">Swift Binary Serialization Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../StdlibAPIGuidelines.html">Swift Standard Library API Design Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../StdlibRationales.html">Rationales for the Swift standard library designs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../StoredAndComputedVariables.html">Stored and Computed Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../StringDesign.html">Swift String Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Testing.html">Testing Swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../TextFormatting.html">Text Formatting in Swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../TransparentAttr.html"><code class="docutils literal"><span class="pre">&#64;_transparent</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../TypeChecker.html">Type Checker Design and Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contents.html">Contents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../weak.html">Weak References</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Swift Programming Language documentation</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
    <li>Clonable</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="../../_sources/proposals/rejected/Clonable.txt" rel="nofollow"> View page source</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="clonable">
<h1>Clonable<a class="headerlink" href="#clonable" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Dave Abrahams</td>
</tr>
<tr class="field-even field"><th class="field-name">Author:</th><td class="field-body">Joe Groff</td>
</tr>
<tr class="field-odd field"><th class="field-name">Date:</th><td class="field-body">2013-03-21</td>
</tr>
<tr class="field-even field"><th class="field-name">Edition:</th><td class="field-body">2</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This proposal was rejected. We decided not to introduce a
language-level copying mechanism for classes.</p>
</div>
<p><strong>Abstract:</strong> to better support the creation of value types, we
propose a “magic” <code class="docutils literal"><span class="pre">Clonable</span></code> protocol and an annotation for describing
which instance variables should be cloned when a type is copied.  This
proposal <strong>augments revision 1</strong> of the Clonable proposal with our
rationale for dropping our support for <code class="docutils literal"><span class="pre">val</span></code> and <code class="docutils literal"><span class="pre">ref</span></code>, a
description of the programming model for generics, and a brief
discussion of equality.  It is <strong>otherwise unchanged</strong>.</p>
<div class="section" id="rationale">
<h2>Rationale<a class="headerlink" href="#rationale" title="Permalink to this headline">¶</a></h2>
<p>By eliminating <code class="docutils literal"><span class="pre">val</span></code>, we lose the easy creation of
runtime-polymorphic value types.  Instead of merely writing:</p>
<div class="highlight-python"><div class="highlight"><pre>val x : MyClass
</pre></div>
</div>
<p>one has to engage in some kind of wrapping and forwarding:</p>
<div class="highlight-python"><div class="highlight"><pre>struct MyClassVal {
  var [clone] value : MyClass

  constructor(x : A, y : B) {
     value = new MyClass(x, y)
  }

  func someFunction(z : C) -&gt; D {
    return value.someFunction(z)
  }

  // ...etc...
}
</pre></div>
</div>
<p>Although such wrapping is awful, this is not the only place where one
would want to do it.  Therefore, some kind of ability to forward an
entire interface wholesale could be added as a separate extension
(getter/setter for <code class="docutils literal"><span class="pre">This</span></code>?), which would solve more problems.  Then it
would be easy enough to write the wrapper as a generic struct and
<code class="docutils literal"><span class="pre">Val&lt;T&gt;</span></code> would be a reality.</p>
<p>By eliminating <code class="docutils literal"><span class="pre">ref</span></code>, we lose the easy creation of references to
value types.  However, among those who prefer programming with values,
having an explicit step for dereferencing might make more sense, so we
could use this generic class:</p>
<blockquote>
<div>class Reference&lt;T&gt; { value : T }</div></blockquote>
<p>If explicit dereferencing isn&#8217;t desired, there&#8217;s always manual (or
automatic, if we add that feature) forwarding.</p>
<p>By dropping <code class="docutils literal"><span class="pre">val</span></code> we also lose some terseness aggregating <code class="docutils literal"><span class="pre">class</span></code>
contents into <code class="docutils literal"><span class="pre">struct</span></code>s.  However, since <code class="docutils literal"><span class="pre">ref</span></code> is being dropped
there&#8217;s less call for a symmetric <code class="docutils literal"><span class="pre">val</span></code>.  The extra “cruft” that
<code class="docutils literal"><span class="pre">[clone]</span></code> adds actually seems appropriate when viewed as a special
bridge for <code class="docutils literal"><span class="pre">class</span></code> types, and less like a penalty against value
types.</p>
</div>
<div class="section" id="generics">
<h2>Generics<a class="headerlink" href="#generics" title="Permalink to this headline">¶</a></h2>
<p>There is actually a straightforward programming model for generics.
If you want to design a generic component where a type parameter <code class="docutils literal"><span class="pre">T</span></code>
binds to both <code class="docutils literal"><span class="pre">class</span></code>es and non-<code class="docutils literal"><span class="pre">class</span></code> types, you can view
<code class="docutils literal"><span class="pre">T</span></code> as a value type where—as with C pointers—the value is the
reference rather than the object being referred to.</p>
<p>Of course, if <code class="docutils literal"><span class="pre">T</span></code> is only supposed to bind to <code class="docutils literal"><span class="pre">class</span></code>es, a
different programming model may work just as well.</p>
</div>
<div class="section" id="implications-for-equality">
<h2>Implications for Equality<a class="headerlink" href="#implications-for-equality" title="Permalink to this headline">¶</a></h2>
<p>We think the programming model suggested for generics has some pretty
strong implications for equality of <code class="docutils literal"><span class="pre">class</span></code>es: <code class="docutils literal"><span class="pre">a</span> <span class="pre">==</span> <span class="pre">b</span></code> must
return true iff <code class="docutils literal"><span class="pre">a</span></code> and <code class="docutils literal"><span class="pre">b</span></code> refer to the same object.</p>
</div>
<div class="section" id="details-unchanged-from-revision-1">
<h2>Details <em>(unchanged from Revision 1)</em><a class="headerlink" href="#details-unchanged-from-revision-1" title="Permalink to this headline">¶</a></h2>
<p>When a type with reference semantics <code class="docutils literal"><span class="pre">R</span></code> is to be used as a part of
(versus merely being referred-to-by) a type with value semantics <code class="docutils literal"><span class="pre">V</span></code>,
a new annotation, <code class="docutils literal"><span class="pre">[clone]</span></code> can be used to indicate that the <code class="docutils literal"><span class="pre">R</span></code>
instance variable should be <code class="docutils literal"><span class="pre">clone()</span></code>d when <code class="docutils literal"><span class="pre">V</span></code> is copied.</p>
<p>A <code class="docutils literal"><span class="pre">class</span></code> can be <code class="docutils literal"><span class="pre">clone()</span></code>d when it implements the built-in <code class="docutils literal"><span class="pre">Clonable</span></code>
protocol:</p>
<div class="highlight-python"><div class="highlight"><pre>protocol Clonable {
   func clone() -&gt; Self { /* see below */ }
}
</pre></div>
</div>
<p>The implementation of <code class="docutils literal"><span class="pre">clone()</span></code> (which will be generated by the
compiler and typically never overridden) performs a primitive copy of
all ordinary instance variables, and a <code class="docutils literal"><span class="pre">clone()</span></code> of all instance
variables marked <code class="docutils literal"><span class="pre">[clone]</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>class FooValue : Clonable  {}

class Bar {}

class Foo : Clonable {
    var count : Int
    var [clone] myValue : FooValue
    var somethingIJustReferTo : Bar
}

struct Baz {
    var [clone] partOfMyValue : Foo
    var anotherPart : Int
    var somethingIJustReferTo : Bar
}
</pre></div>
</div>
<p>When a <code class="docutils literal"><span class="pre">Baz</span></code> is copied by any of the “big three” operations (variable
initialization, assignment, or function argument passing), even as
part of a larger <code class="docutils literal"><span class="pre">struct</span></code>, its <code class="docutils literal"><span class="pre">[clone]</span></code> member is <code class="docutils literal"><span class="pre">clone()</span></code>d.
Because <code class="docutils literal"><span class="pre">Foo</span></code> itself has a <code class="docutils literal"><span class="pre">[clone]</span></code> member, that is <code class="docutils literal"><span class="pre">clone()</span></code>d
also.  Therefore copying a <code class="docutils literal"><span class="pre">Baz</span></code> object <code class="docutils literal"><span class="pre">clone()</span></code>s a <code class="docutils literal"><span class="pre">Foo</span></code> and
<code class="docutils literal"><span class="pre">clone()</span></code>ing a <code class="docutils literal"><span class="pre">Foo</span></code> <code class="docutils literal"><span class="pre">clone()</span></code>s a <code class="docutils literal"><span class="pre">FooValue</span></code>.</p>
<p>All <code class="docutils literal"><span class="pre">struct</span></code>s are <code class="docutils literal"><span class="pre">Clonable</span></code> by default, with <code class="docutils literal"><span class="pre">clone()</span></code> delivering
ordinary copy semantics.  Therefore,</p>
<div class="highlight-python"><div class="highlight"><pre>var x : Baz
var y = x.clone()
</pre></div>
</div>
<p>is equivalent to</p>
<div class="highlight-python"><div class="highlight"><pre>var x : Baz
var y = x
</pre></div>
</div>
<p>Note that <code class="docutils literal"><span class="pre">Clonable</span></code> is the first protocol with a default
implementation that can&#8217;t currently be written in the standard library
(though arguably we&#8217;d like to add the capability to write that
implementation).</p>
</div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright apple.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.1.9',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>