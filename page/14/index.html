<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="yosita" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description" content="terry yang&apos;s blog | java | scala | bi">
<meta property="og:type" content="website">
<meta property="og:title" content="yosita">
<meta property="og:url" content="http://yoursite.com/page/14/index.html">
<meta property="og:site_name" content="yosita">
<meta property="og:description" content="terry yang&apos;s blog | java | scala | bi">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="yosita">
<meta name="twitter:description" content="terry yang&apos;s blog | java | scala | bi">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> yosita </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?953e46480b0a75d01aaf6d872cc77099";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>






  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">yosita</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">yosita</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      

      
      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">

    

    
    
      
      

      
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/08/20/ouvens.github.io/frontend-javascript/2015-08-20-mvvm-qvm-frame/" itemprop="url">
                  移动端mvvm框架qvm实现
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-08-20T00:00:00+08:00" content="2015-08-20">
              2015-08-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/frontend-javascript/" itemprop="url" rel="index">
                    <span itemprop="name">frontend-javascript</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/08/20/ouvens.github.io/frontend-javascript/2015-08-20-mvvm-qvm-frame/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/08/20/ouvens.github.io/frontend-javascript/2015-08-20-mvvm-qvm-frame/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p><a href="https://github.com/ouvens/qvm" target="_blank" rel="external">gitHub地址</a></p>
<h3 id="1_uFF0C_u79FB_u52A8_u7AEFminimvvm_u6846_u67B6qvm_u5B9E_u73B0"><a href="#1_uFF0C_u79FB_u52A8_u7AEFminimvvm_u6846_u67B6qvm_u5B9E_u73B0" class="headerlink" title="1，移动端minimvvm框架qvm实现"></a>1，移动端minimvvm框架qvm实现</h3><p>qvm概念，一个适用于移动端的mini mvvm(什么是mvvm？没了解的同学自己去了解)框架。参考了angular和vuejs的设计实现思路，并进行简化封装，目前使用的zepto基本依赖库，使用最少的代码实现了基础功能版。</p>
<h3 id="2_uFF0C_u4E3A_u4EC0_u4E48_u8981_u505A_u5B83"><a href="#2_uFF0C_u4E3A_u4EC0_u4E48_u8981_u505A_u5B83" class="headerlink" title="2，为什么要做它"></a>2，为什么要做它</h3><p>PC浏览器时代，实现mvvm有着麻烦的兼容性问题。而在移动浏览器时代，浏览器原生的支持可以让我们用最少的代码来实现一个mvvm框架库，来最大程度的减少移动端业务代码的开发工作。预计对于中大型的移动前端应用项目，使用mvvm能减少至少30%的业务量，让项目更容易维护。<br>   (不过目前仍有很多不完善的地方后面需要持续改进)</p>
<h3 id="3_uFF0C_u53CA_u5176_u7B80_u5355_u7684API_u4ECB_u7ECD"><a href="#3_uFF0C_u53CA_u5176_u7B80_u5355_u7684API_u4ECB_u7ECD" class="headerlink" title="3，及其简单的API介绍"></a>3，及其简单的API介绍</h3><p>directive: 以q-开始的属性为我们定义的元素动作指令</p>
<h6 id="vm_u6A21_u578B_u7ED3_u6784_u4ECB_u7ECD_uFF1A"><a href="#vm_u6A21_u578B_u7ED3_u6784_u4ECB_u7ECD_uFF1A" class="headerlink" title="vm模型结构介绍："></a>vm模型结构介绍：</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">$id: 823832887973495, //qvm对象的全局id,每个qvm对象对应一个</span><br><span class="line">$elem: #div, //对应的view</span><br><span class="line">$model: &#123;  //viewModel,通过directive关联view和model的操作</span><br><span class="line">    text:&#123;</span><br><span class="line">        ns: ns, //获取对象data或指令的namespace</span><br><span class="line">        accessor: accessor, //同一的外部访问器，vm通过修改它来改变</span><br><span class="line">        key: text, //指令名称</span><br><span class="line">        directive： [directive], //指令集</span><br><span class="line">        setter: function, //对象设置方法</span><br><span class="line">        getter: function, //对象获取值方法</span><br><span class="line">        tpl: #div //模板字符串,部分指令需要使用，如repeat</span><br><span class="line">        //后续可能还要增加</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line">data: &#123;      //对应的model，即数据层</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="3-1_q-text__u6539_u53D8_u8282_u70B9innerHTML"><a href="#3-1_q-text__u6539_u53D8_u8282_u70B9innerHTML" class="headerlink" title="3.1 q-text 改变节点innerHTML"></a>3.1 q-text 改变节点innerHTML</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">"demo"</span> q-text=<span class="string">'text'</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"js/zepto.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"js/qvm.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="actionscript"></span><br><span class="line"><span class="keyword">var</span> vm = qvm.<span class="keyword">get</span>(&#123;</span><br><span class="line">    selector: <span class="string">'#demo'</span>,</span><br><span class="line">    data:&#123;</span><br><span class="line">        text: <span class="string">'&lt;h2&gt;Hello World!&lt;/h2&gt;'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    vm.text.accessor = <span class="string">'&lt;h2&gt;Fuck World!&lt;/h2&gt;'</span>;    <span class="comment">//渲染html，通过改变accessor改变innerHTML。</span></span><br><span class="line">&#125;,<span class="number">4000</span>)</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h6 id="3-2_q-class__u6539_u53D8_u8282_u70B9class_u5C5E_u6027"><a href="#3-2_q-class__u6539_u53D8_u8282_u70B9class_u5C5E_u6027" class="headerlink" title="3.2 q-class 改变节点class属性"></a>3.2 q-class 改变节点class属性</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">.red&#123;</span><br><span class="line">    color: red;</span><br><span class="line">&#125;</span><br><span class="line">.green&#123;</span><br><span class="line">    color: green;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;div id="demo" q-text='text' q-class="color"&gt;&lt;/div&gt;</span><br><span class="line">&lt;script type="text/javascript" src="js/zepto.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type="text/javascript" src="js/qvm.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var vm = qvm.get(&#123;</span><br><span class="line">    selector: '#demo',</span><br><span class="line">    data:&#123;</span><br><span class="line">        text: '&lt;h2&gt;Hello World!&lt;/h2&gt;',</span><br><span class="line">        color: 'red'</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">setTimeout(function()&#123;</span><br><span class="line">    vm.text.accessor = '&lt;h2&gt;Fuck World!&lt;/h2&gt;';</span><br><span class="line">    vm.class.accessor = 'green';</span><br><span class="line">&#125;,4000)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h6 id="3-3_q-attr_u6570_u636E_u5C5E_u6027_u8D4B_u503C"><a href="#3-3_q-attr_u6570_u636E_u5C5E_u6027_u8D4B_u503C" class="headerlink" title="3.3 q-attr数据属性赋值"></a>3.3 q-attr数据属性赋值</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;<span class="xml"><span class="tag">&lt;<span class="title">a</span>&gt;</span><span class="tag">&lt;<span class="title">img</span> <span class="attribute">id</span>=<span class="value">"demo"</span> <span class="attribute">q-attr-src</span>=<span class="value">"img"</span> <span class="attribute">width</span>=<span class="value">"50"</span> <span class="attribute">height</span>=<span class="value">"30"</span>&gt;</span><span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"js/zepto.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"js/qvm.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="actionscript"></span><br><span class="line"><span class="keyword">var</span> vm = qvm.<span class="keyword">get</span>(&#123;</span><br><span class="line">    selector: <span class="string">'#demo'</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">        img: <span class="string">'http://9.url.cn/edu/banner/img/505d9c39_760_300.jpg'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    vm.attr_src.accessor = <span class="string">'http://9.url.cn/edu/banner/img/880facff_760_300.jpg'</span>;</span><br><span class="line">&#125;,<span class="number">4000</span>);</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>vm.class.accessor = ‘green’; 改变元素的class类，从red改为green。<br>这里注意一下使用attr- 和data-指令使用attr_src和data_src来读取访问器，后面需要统一接口。</p>
<h6 id="3-4_q-data_u6570_u636E_u5C5E_u6027_u8D4B_u503C"><a href="#3-4_q-data_u6570_u636E_u5C5E_u6027_u8D4B_u503C" class="headerlink" title="3.4 q-data数据属性赋值"></a>3.4 q-data数据属性赋值</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">"demo"</span> q-data-title=<span class="string">"text"</span>&gt;<span class="xml"><span class="tag">&lt;<span class="title">a</span>&gt;</span><span class="tag">&lt;<span class="title">img</span> <span class="attribute">q-attr-src</span>=<span class="value">"img"</span> <span class="attribute">width</span>=<span class="value">"50"</span> <span class="attribute">height</span>=<span class="value">"30"</span>&gt;</span><span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"js/zepto.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"js/qvm.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="actionscript"></span><br><span class="line"><span class="keyword">var</span> vm = qvm.<span class="keyword">get</span>(&#123;</span><br><span class="line">    selector: <span class="string">'#demo'</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">        text: <span class="string">'PS 大神教程'</span>,</span><br><span class="line">        img: <span class="string">'http://9.url.cn/edu/banner/img/505d9c39_760_300.jpg'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    vm.data_title.accessor = <span class="string">'艺术人生'</span>;</span><br><span class="line">&#125;,<span class="number">4000</span>);</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>此方法用于改变data属性。</p>
<h6 id="3-5_q-repeat__u5D4C_u5957_u4F7F_u7528"><a href="#3-5_q-repeat__u5D4C_u5957_u4F7F_u7528" class="headerlink" title="3.5 q-repeat 嵌套使用"></a>3.5 q-repeat 嵌套使用</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">    &lt;style&gt;</span><br><span class="line">    .red&#123;</span><br><span class="line">        color: red;</span><br><span class="line">    &#125;</span><br><span class="line">    .green&#123;</span><br><span class="line">        color: green;</span><br><span class="line">    &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">    &lt;div id="demo" q-class="color" q-repeat="list"&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">        &lt;img q-attr-src="img" width="50" height="30"&gt;&lt;span q-text="title" q-class="color"&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;script type="text/javascript" src="js/zepto.js"&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script type="text/javascript" src="js/qvm.js"&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">    var list =[&#123;</span><br><span class="line">                img: 'http://9.url.cn/edu/banner/img/10b0af94_760_300.jpg',</span><br><span class="line">                title: '音乐改变世界'</span><br><span class="line">            &#125;,&#123;</span><br><span class="line">                img: 'http://9.url.cn/edu/banner/img/880facff_760_300.jpg',</span><br><span class="line">                title: 'PS 大神教程'</span><br><span class="line">            &#125;,&#123;</span><br><span class="line">                img: 'http://9.url.cn/edu/banner/img/505d9c39_760_300.jpg',</span><br><span class="line">                title: '艺术人生'</span><br><span class="line">            &#125;];</span><br><span class="line">    var vm = qvm.get(&#123;</span><br><span class="line">        selector: '#demo',</span><br><span class="line">        data:&#123;</span><br><span class="line">            text: '&lt;h2&gt;Hello World!&lt;/h2&gt;',</span><br><span class="line">            color: 'red',</span><br><span class="line">            list: list</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    setTimeout(function()&#123;</span><br><span class="line">        delete list[2];</span><br><span class="line">        list[0].title='music change the world';</span><br><span class="line">        list[1].title='PS master learning';</span><br><span class="line">        vm.class.accessor = 'green';</span><br><span class="line">        vm.repeat.accessor = list;</span><br><span class="line">    &#125;,4000);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">delete list[2];</span><br><span class="line">list[0].title='music change the world';</span><br><span class="line">list[1].title='PS master learning';</span><br><span class="line">改变repeat渲染数组的内容，只对数组进行修改和删除长度。</span><br></pre></td></tr></table></figure>
<h6 id="3-6_q-_u5BF9_u8C61_u5185_u90E8_u6E32_u67D3"><a href="#3-6_q-_u5BF9_u8C61_u5185_u90E8_u6E32_u67D3" class="headerlink" title="3.6 q-对象内部渲染"></a>3.6 q-对象内部渲染</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">.red&#123;</span><br><span class="line">    color: red;</span><br><span class="line">&#125;</span><br><span class="line">.green&#123;</span><br><span class="line">    color: green;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;div id="demo" q-repeat="list"&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;span q-class="color" q-text="title"&gt;&lt;/span&gt;</span><br><span class="line">        &lt;span&gt;</span><br><span class="line">            &lt;img q-attr-src="img.src" width="50" height="30"&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script type="text/javascript" src="js/zepto.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type="text/javascript" src="js/qvm.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var data = &#123;</span><br><span class="line">    title: '&lt;h2&gt;Hello World!&lt;/h2&gt;',</span><br><span class="line">    color: 'red',</span><br><span class="line">    img: &#123;</span><br><span class="line">        src: 'http://9.url.cn/edu/banner/img/880facff_760_300.jpg'</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">var vm = qvm.get(&#123;</span><br><span class="line">    selector: '#demo',</span><br><span class="line">    data: &#123;</span><br><span class="line">        list: data</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">setTimeout(function()&#123;</span><br><span class="line">    data.color = 'green';</span><br><span class="line">    data.title = '&lt;h2&gt;Fuck World!&lt;/h2&gt;';</span><br><span class="line">    data.img.src = 'http://9.url.cn/edu/banner/img/10b0af94_760_300.jpg';</span><br><span class="line">    vm.repeat.accessor = data;</span><br><span class="line">&#125;,4000);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>qvm支持嵌套渲染，但是viewModel以定义的最外层数据为准。</p>
<h6 id="3-7_q-on_u7B80_u5355_u4E8B_u4EF6_u7ED1_u5B9A"><a href="#3-7_q-on_u7B80_u5355_u4E8B_u4EF6_u7ED1_u5B9A" class="headerlink" title="3.7 q-on简单事件绑定"></a>3.7 q-on简单事件绑定</h6><p>定义的动作和事件名，目前子节点上的on代理在根元素上，避免了重复绑定，如果根节点和根节点同时含有on方法，则按照冒泡的原则进行事件处理。实现时使用了根节点循环向下传递的方式。</p>
<h6 id="u793A_u4F8B"><a href="#u793A_u4F8B" class="headerlink" title="示例"></a>示例</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">.red&#123;</span><br><span class="line">    color: red;</span><br><span class="line">&#125;</span><br><span class="line">.green&#123;</span><br><span class="line">    color: green;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;div id="demo" q-repeat="list" q-on="click|action"&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;span q-class="color" q-text="title"&gt;&lt;/span&gt;</span><br><span class="line">        &lt;span&gt;</span><br><span class="line">            &lt;img q-attr-src="img.src" width="50" height="30"&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script type="text/javascript" src="js/zepto.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type="text/javascript" src="js/qvm.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var data = &#123;</span><br><span class="line">    title: '&lt;h2&gt;点我!&lt;/h2&gt;',</span><br><span class="line">    color: 'red',</span><br><span class="line">    img: &#123;</span><br><span class="line">        src: 'http://9.url.cn/edu/banner/img/880facff_760_300.jpg'</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">var vm = qvm.get(&#123;</span><br><span class="line">    selector: '#demo',</span><br><span class="line">    data: &#123;</span><br><span class="line">        list: data</span><br><span class="line">    &#125;,</span><br><span class="line">    action: function()&#123;</span><br><span class="line">        alert('点击事件!');</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>目前实现了节点事件代理到最外层的qmv对象元素上。不对内部元素做绑定。</p>
<h6 id="3-8_q-*_u81EA_u5B9A_u4E49directive"><a href="#3-8_q-*_u81EA_u5B9A_u4E49directive" class="headerlink" title="3.8 q-*自定义directive"></a>3.8 q-*自定义directive</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">.red&#123;</span><br><span class="line">    color: red;</span><br><span class="line">&#125;</span><br><span class="line">.green&#123;</span><br><span class="line">    color: green;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;div id="demo" q-repeat="list" q-on="click|action" q-self='selfProcess'&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;span q-class="color" q-text="title"&gt;&lt;/span&gt;</span><br><span class="line">        &lt;span&gt;</span><br><span class="line">            &lt;img q-attr-src="img.src" width="50" height="30"&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script type="text/javascript" src="js/zepto.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type="text/javascript" src="js/qvm.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var data = &#123;</span><br><span class="line">    title: '&lt;h2&gt;点我!&lt;/h2&gt;',</span><br><span class="line">    color: 'red',</span><br><span class="line">    img: &#123;</span><br><span class="line">        src: 'http://9.url.cn/edu/banner/img/880facff_760_300.jpg'</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">var vm = qvm.get(&#123;</span><br><span class="line">    selector: '#demo',</span><br><span class="line">    data: &#123;</span><br><span class="line">        list: data</span><br><span class="line">    &#125;,</span><br><span class="line">    action: function()&#123;</span><br><span class="line">        alert('点击事件!');</span><br><span class="line">    &#125;,</span><br><span class="line">    selfProcess: function(key, vm)&#123;</span><br><span class="line">        console.log(key, vm);</span><br><span class="line">        alert('我是一个自定义处理指令!嘿嘿嘿~')</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>子定义的指令需要遵守一定的规则，例如下面q-self对应的指令为selfProcess的函数，则节点扫描时会自动执行self指令的selfProcess函数。</p>
<p>TODO：<br>更好的dirtycheck实现，类似virtual dom的方式~</p>

          
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/08/16/ouvens.github.io/frontend-build/2015-08-16-gulp-dev-build-demo/" itemprop="url">
                  gulp搭建简单构建环境
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-08-16T00:00:00+08:00" content="2015-08-16">
              2015-08-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/frontend-build/" itemprop="url" rel="index">
                    <span itemprop="name">frontend-build</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/08/16/ouvens.github.io/frontend-build/2015-08-16-gulp-dev-build-demo/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/08/16/ouvens.github.io/frontend-build/2015-08-16-gulp-dev-build-demo/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Gulp 是一款基于任务的设计模式的自动化工具，通过插件的配合解决全套前端解决方案，如静态页面压缩、图片压缩、JS合并、SASS同步编译并压缩CSS、服务器控制客户端同步刷新。</p>
<p>所有功能前提需要安装nodejs和ruby。</p>
<h4 id="Gulp_u5B89_u88C5"><a href="#Gulp_u5B89_u88C5" class="headerlink" title="Gulp安装"></a>Gulp安装</h4><p>全局安装Gulpjs</p>
<p>  npm install -g gulp  #全局安装</p>
<p>局部安装Gulpjs</p>
<p>  npm install gulp –save-dev # 局部安装</p>
<p>全局安装</p>
<ol>
<li>将安装包放在 /usr/local 下</li>
<li>可以直接在命令行里使用</li>
</ol>
<p>本地安装</p>
<ol>
<li>将安装包放在 ./node_modules 下（运行npm时所在的目录）</li>
<li>可以通过 require() 来引入本地安装的包</li>
</ol>
<h4 id="u9009_u62E9Gulp_u7EC4_u4EF6"><a href="#u9009_u62E9Gulp_u7EC4_u4EF6" class="headerlink" title="选择Gulp组件"></a>选择Gulp组件</h4><p>前端项目需要的功能：<br>1、图片（压缩图片支持jpg、png、gif）<br>2、样式 （支持sass 同时支持合并、压缩、重命名）<br>3、javascript （检查、合并、压缩、重命名）<br>4、html （压缩）<br>5、客户端同步刷新显示修改<br>6、构建项目前清除发布环境下的文件（保持发布环境的清洁）</p>
<p>通过gulp plugins，寻找对于的gulp组件<br>gulp-imagemin: 压缩图片<br>gulp-ruby-sass: 支持sass<br>gulp-minify-css: 压缩css<br>gulp-jshint: 检查js<br>gulp-uglify: 压缩js<br>gulp-concat: 合并文件<br>gulp-rename: 重命名文件<br>gulp-htmlmin: 压缩html<br>gulp-clean: 清空文件夹<br>gulp-livereload: 服务器控制客户端同步刷新（需配合chrome插件LiveReload及tiny-lr）</p>
<h4 id="u5B89_u88C5Gulp_u7EC4_u4EF6"><a href="#u5B89_u88C5Gulp_u7EC4_u4EF6" class="headerlink" title="安装Gulp组件"></a>安装Gulp组件</h4><p>安装组件项目目录，通过cd project 进入目录，执行下边的npm安装组件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">npm install gulp-util gulp-imagemin gulp-ruby-sass gulp-minify-css gulp-jshint gulp-uglify gulp-rename gulp-concat gulp-clean gulp-livereload tiny-lr --save-dev</span><br></pre></td></tr></table></figure>
<p>项目目录结构</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">project(项目名称)</span><br><span class="line">|–.git 通过git管理项目会生成这个文件夹</span><br><span class="line">|–node_modules 组件目录</span><br><span class="line">|–dist 发布环境</span><br><span class="line">    |–css 样式文件(style.css style.min.css)</span><br><span class="line">    |–images 图片文件(压缩图片)</span><br><span class="line">    |–js js文件(main.js main.min.js)</span><br><span class="line">    |–index.html 静态文件(压缩html)</span><br><span class="line">|–src 生产环境</span><br><span class="line">    |–sass sass文件</span><br><span class="line">    |–images 图片文件</span><br><span class="line">    |–js js文件</span><br><span class="line">    |–index.html 静态文件</span><br><span class="line">|–.jshintrc jshint配置文件</span><br><span class="line">|–gulpfile.js gulp任务文件</span><br></pre></td></tr></table></figure>
<p>Windows 下安装ruby和sass，下载安装ruby，<a href="http://rubyinstaller.org/downloads/" target="_blank" rel="external">http://rubyinstaller.org/downloads/</a> ，安装完成后使用 gem install sass安装sass</p>
<p>由于网络，安装时注意网络和更换国内安装源：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ gem sources --remove https:<span class="comment">//rubygems.org/</span></span><br><span class="line">$ gem sources -a https:<span class="comment">//ruby.taobao.org/</span></span><br><span class="line">$ gem sources -l</span><br></pre></td></tr></table></figure>
<p><strong><em> CURRENT SOURCES </em></strong><br><a href="https://ruby.taobao.org" target="_blank" rel="external">https://ruby.taobao.org</a></p>
<p>确保只有 ruby.taobao.org后</p>
<p>  $ gem install rails</p>
<p>gulp基础语法<br>gulp通过gulpfile文件来完成相关任务，因此项目中必须包含gulpfile.js</p>
<p>gulp有五个方法：src、dest、task、run、watch<br>src和dest：指定源文件和处理后文件的路径<br>watch：用来监听文件的变化<br>task：指定任务<br>run：执行任务</p>
<p>编写gulp任务</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 组件安装</span><br><span class="line"> * npm install gulp-util gulp-imagemin gulp-ruby-sass gulp-minify-css gulp-jshint gulp-uglify gulp-rename gulp-concat gulp-clean gulp-livereload tiny-lr --save-dev</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入 gulp及组件</span></span><br><span class="line"><span class="keyword">var</span> gulp    = <span class="built_in">require</span>(<span class="string">'gulp'</span>),                 <span class="comment">//基础库</span></span><br><span class="line">    imagemin = <span class="built_in">require</span>(<span class="string">'gulp-imagemin'</span>),       <span class="comment">//图片压缩</span></span><br><span class="line">    sass = <span class="built_in">require</span>(<span class="string">'gulp-ruby-sass'</span>),          <span class="comment">//sass</span></span><br><span class="line">    minifycss = <span class="built_in">require</span>(<span class="string">'gulp-minify-css'</span>),    <span class="comment">//css压缩</span></span><br><span class="line">    jshint = <span class="built_in">require</span>(<span class="string">'gulp-jshint'</span>),           <span class="comment">//js检查</span></span><br><span class="line">    uglify  = <span class="built_in">require</span>(<span class="string">'gulp-uglify'</span>),          <span class="comment">//js压缩</span></span><br><span class="line">    rename = <span class="built_in">require</span>(<span class="string">'gulp-rename'</span>),           <span class="comment">//重命名</span></span><br><span class="line">    concat  = <span class="built_in">require</span>(<span class="string">'gulp-concat'</span>),          <span class="comment">//合并文件</span></span><br><span class="line">    clean = <span class="built_in">require</span>(<span class="string">'gulp-clean'</span>),             <span class="comment">//清空文件夹</span></span><br><span class="line">    tinylr = <span class="built_in">require</span>(<span class="string">'tiny-lr'</span>),               <span class="comment">//livereload</span></span><br><span class="line">    server = tinylr(),</span><br><span class="line">    port = <span class="number">35729</span>,</span><br><span class="line">    livereload = <span class="built_in">require</span>(<span class="string">'gulp-livereload'</span>);   <span class="comment">//livereload</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// HTML处理</span></span><br><span class="line">gulp.task(<span class="string">'html'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> htmlSrc = <span class="string">'./src/*.html'</span>,</span><br><span class="line">        htmlDst = <span class="string">'./dist/'</span>;</span><br><span class="line"></span><br><span class="line">    gulp.src(htmlSrc)</span><br><span class="line">        .pipe(livereload(server))</span><br><span class="line">        .pipe(gulp.dest(htmlDst))</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 样式处理</span></span><br><span class="line">gulp.task(<span class="string">'css'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> cssSrc = <span class="string">'./src/scss/*.scss'</span>,</span><br><span class="line">        cssDst = <span class="string">'./dist/css'</span>;</span><br><span class="line"></span><br><span class="line">    gulp.src(cssSrc)</span><br><span class="line">        .pipe(sass(&#123; style: <span class="string">'expanded'</span>&#125;))</span><br><span class="line">        .pipe(gulp.dest(cssDst))</span><br><span class="line">        .pipe(rename(&#123; suffix: <span class="string">'.min'</span> &#125;))</span><br><span class="line">        .pipe(minifycss())</span><br><span class="line">        .pipe(livereload(server))</span><br><span class="line">        .pipe(gulp.dest(cssDst));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 图片处理</span></span><br><span class="line">gulp.task(<span class="string">'images'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> imgSrc = <span class="string">'./src/images/**/*'</span>,</span><br><span class="line">        imgDst = <span class="string">'./dist/images'</span>;</span><br><span class="line">    gulp.src(imgSrc)</span><br><span class="line">        .pipe(imagemin())</span><br><span class="line">        .pipe(livereload(server))</span><br><span class="line">        .pipe(gulp.dest(imgDst));</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// js处理</span></span><br><span class="line">gulp.task(<span class="string">'js'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> jsSrc = <span class="string">'./src/js/*.js'</span>,</span><br><span class="line">        jsDst =<span class="string">'./dist/js'</span>;</span><br><span class="line"></span><br><span class="line">    gulp.src(jsSrc)</span><br><span class="line">        .pipe(jshint(<span class="string">'.jshintrc'</span>))</span><br><span class="line">        .pipe(jshint.reporter(<span class="string">'default'</span>))</span><br><span class="line">        .pipe(concat(<span class="string">'main.js'</span>))</span><br><span class="line">        .pipe(gulp.dest(jsDst))</span><br><span class="line">        .pipe(rename(&#123; suffix: <span class="string">'.min'</span> &#125;))</span><br><span class="line">        .pipe(uglify())</span><br><span class="line">        .pipe(livereload(server))</span><br><span class="line">        .pipe(gulp.dest(jsDst));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 清空图片、样式、js</span></span><br><span class="line">gulp.task(<span class="string">'clean'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    gulp.src([<span class="string">'./dist/css'</span>, <span class="string">'./dist/js'</span>, <span class="string">'./dist/images'</span>], &#123;read: <span class="literal">false</span>&#125;)</span><br><span class="line">        .pipe(clean());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认任务 清空图片、样式、js并重建 运行语句 gulp</span></span><br><span class="line">gulp.task(<span class="string">'default'</span>, [<span class="string">'clean'</span>], <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    gulp.start(<span class="string">'html'</span>,<span class="string">'css'</span>,<span class="string">'images'</span>,<span class="string">'js'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听任务 运行语句 gulp watch</span></span><br><span class="line">gulp.task(<span class="string">'watch'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    server.listen(port, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">console</span>.log(err);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 监听html</span></span><br><span class="line">        gulp.watch(<span class="string">'./src/*.html'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">            gulp.run(<span class="string">'html'</span>);</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 监听css</span></span><br><span class="line">        gulp.watch(<span class="string">'./src/scss/*.scss'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            gulp.run(<span class="string">'css'</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 监听images</span></span><br><span class="line">        gulp.watch(<span class="string">'./src/images/**/*'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            gulp.run(<span class="string">'images'</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 监听js</span></span><br><span class="line">        gulp.watch(<span class="string">'./src/js/*.js'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            gulp.run(<span class="string">'js'</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>LiveReload配置</strong></p>
<p>1、安装Chrome LiveReload<br>2、通过npm安装http-server ，快速建立http服务</p>
<p>  npm install http-server -g</p>
<p>3、通过cd找到发布环境目录dist<br>4、运行http-server，默认端口是8080<br>5、访问路径localhost:8080<br>6、再打开一个cmd，通过cd找到项目路径执行gulp，清空发布环境并初始化<br>7、执行监控 gulp<br>8、点击chrome上的LiveReload插件，空心变成实心即关联上，你可以修改css、js、html即时会显示到页面中。</p>

          
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/08/15/ouvens.github.io/frontend-build/2015-08-15-fis3-study-rearch/" itemprop="url">
                  fis3试用与构建配置研究
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-08-15T00:00:00+08:00" content="2015-08-15">
              2015-08-15
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/frontend-build/" itemprop="url" rel="index">
                    <span itemprop="name">frontend-build</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/08/15/ouvens.github.io/frontend-build/2015-08-15-fis3-study-rearch/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/08/15/ouvens.github.io/frontend-build/2015-08-15-fis3-study-rearch/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="u4E00_u3001_u5B89_u88C5"><a href="#u4E00_u3001_u5B89_u88C5" class="headerlink" title="一、安装"></a>一、安装</h3><ul>
<li>安装初始化</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="tag">i</span> -g fis3</span><br><span class="line">fis3 -v</span><br><span class="line">fis3 init</span><br></pre></td></tr></table></figure>
<h3 id="u4E8C_u3001_u914D_u7F6E"><a href="#u4E8C_u3001_u914D_u7F6E" class="headerlink" title="二、配置"></a>二、配置</h3><p>类似Gruntfile.js或Gulpfile.js，新建fis-config.js文件<br>配置api介绍如下：</p>
<h4 id="fis-set_28key_2C_value_29"><a href="#fis-set_28key_2C_value_29" class="headerlink" title="fis.set(key, value)"></a>fis.set(key, value)</h4><p>设置一些配置，如系统内置属性 project、namespace、modules、settings。 fis.set 设置的值通过fis.get()获取</p>
<h4 id="fis-get_28key_29"><a href="#fis-get_28key_29" class="headerlink" title="fis.get(key)"></a>fis.get(key)</h4><p>获取已经配置的属性，和 fis.set() 成对使用</p>
<h4 id="fis-match_28selector_2C_props_2C__5B_2C_important_5D_29"><a href="#fis-match_28selector_2C_props_2C__5B_2C_important_5D_29" class="headerlink" title="fis.match(selector, props, [, important])"></a>fis.match(selector, props, [, important])</h4><p>给匹配到的文件分配属性，文件属性决定了这个文件进行怎么样的操作；fis.match 模拟一个类似 css 的覆盖规则，负责给文件分配规则属性，这些规则属性决定了这个文件将会被如何处理；另外，后面分配到的规则会覆盖前面的；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fis.match(<span class="string">'&#123;a,b&#125;.js'</span>, &#123;</span><br><span class="line">    release: <span class="string">'/static/\$0'</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">fis.match(<span class="string">'b.js'</span>, &#123;</span><br><span class="line">    release: <span class="string">'/static/new/\$0'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这里b.js的输出为 /static/new/$0，如果important为true则规则不能被覆盖</p>
<h4 id="fis-media_28mode_29"><a href="#fis-media_28mode_29" class="headerlink" title="fis.media(mode)"></a>fis.media(mode)</h4><p>fis.media 是模仿自 css 的 @media，表示不同的状态。这是 fis3 中的一个重要概念，其意味着有多份配置，每一份配置都可以让 fis3 进行不同的编译；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fis.media(<span class="string">'dev'</span>).match(<span class="string">'*.js'</span>, &#123;</span><br><span class="line">    optimizer: <span class="literal">null</span></span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">fis.media(<span class="string">'rd'</span>).match(<span class="string">'*.js'</span>, &#123;</span><br><span class="line">  domain: <span class="string">'http://rd-host/static/cdn'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="fis-plugin_28name_2C__5Bprops_2C__5B_2C_place_5D_5D_29"><a href="#fis-plugin_28name_2C__5Bprops_2C__5B_2C_place_5D_5D_29" class="headerlink" title="fis.plugin(name, [props, [, place]])"></a>fis.plugin(name, [props, [, place]])</h4><p><a href="http://fis.baidu.com/fis3/docs/api/config-api.html#%E5%85%A8%E5%B1%80%E5%B1%9E%E6%80%A7" target="_blank" rel="external">http://fis.baidu.com/fis3/docs/api/config-api.html#%E5%85%A8%E5%B1%80%E5%B1%9E%E6%80%A7</a></p>
<p>####–几种重要属性设置</p>
<ol>
<li>全局属性介绍：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> DEFAULT_SETTINGS = &#123;</span><br><span class="line">  project: &#123;</span><br><span class="line">    charset: <span class="string">'utf8'</span>,    <span class="comment">//字符编码，@param: string</span></span><br><span class="line">    md5Length: <span class="number">7</span>,    <span class="comment">//md5长度， @param: number</span></span><br><span class="line">    md5Connector: <span class="string">'_'</span>,    <span class="comment">//设置md5与文件的连接字符，@param: string</span></span><br><span class="line">    files: [<span class="string">'**'</span>],    <span class="comment">//设置项目源码文件过滤器，@param:</span></span><br><span class="line">    ignore: [<span class="string">'node_modules/**'</span>, <span class="string">'output/**'</span>, <span class="string">'.git/**'</span>, <span class="string">'fis-conf.js'</span>]    <span class="comment">//排除某些不处理的文件</span></span><br><span class="line">    fileType:&#123;</span><br><span class="line">        text: [<span class="string">'html'</span>, <span class="string">'js'</span>],    <span class="comment">//追加文本文件后缀列表，@param: array | string</span></span><br><span class="line">        image: [<span class="string">'png'</span>]    <span class="comment">//最佳图片类二进制文件后缀列表，@param: array | string</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// project的属性也可以通过 fis.set('project.charset', 'utf8') 来设置，其它的类似</span></span><br><span class="line"> </span><br><span class="line">  component: &#123;</span><br><span class="line">    skipRoadmapCheck: <span class="literal">true</span>,  </span><br><span class="line">    protocol: <span class="string">'github'</span>,</span><br><span class="line">    author: <span class="string">'fis-components'</span></span><br><span class="line">  &#125;,</span><br><span class="line"> </span><br><span class="line">  modules: &#123;</span><br><span class="line">    hook: <span class="string">'components'</span>,</span><br><span class="line">    packager: <span class="string">'map'</span></span><br><span class="line">  &#125;,</span><br><span class="line"> </span><br><span class="line">  options: &#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol>
<li>文件属性：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">fis.set(<span class="string">'timeDate'</span>, <span class="built_in">Date</span>.now());    <span class="comment">//获取当前时间戳</span></span><br><span class="line">fis.match(<span class="string">'/widget/&#123;*,**/*&#125;.js'</span>, &#123;</span><br><span class="line">    charset: <span class="string">'utf8'</span>,    <span class="comment">//指定文本文件的输出编码。@param: string</span></span><br><span class="line">    url: <span class="string">'/static/proj/pkg_widget.js'</span>, <span class="comment">//指定文件的资源定位路径，以 / 开头。默认是 release 的值，url可以与发布路径 release 不一致。@param: string</span></span><br><span class="line">    release: <span class="string">'/static/$0'</span>,    <span class="comment">//设置文件的产出路径。设置为false表示不生成文件,@param: string</span></span><br><span class="line">    packTo: <span class="string">'/static/pkg_widget.js'</span>,     <span class="comment">//分配到这个属性的文件将会合并到这个属性配置的文件中,@param: string</span></span><br><span class="line">    query: <span class="string">'?=t'</span> + fis.get(<span class="string">'timeDate'</span>),    <span class="comment">//指定文件的资源定位路径之后的query，比如'?t=123124132'。@param: string</span></span><br><span class="line">    isHtmlLike: <span class="literal">true</span>,     <span class="comment">//指定对文件进行 html 相关语言能力处理.@param: bool</span></span><br><span class="line">    isCssLike: <span class="literal">true</span>,     <span class="comment">//指定对文件进行 css 相关的语言能力处理.@param: bool</span></span><br><span class="line">    isJsLike: <span class="literal">true</span>,    <span class="comment">//指定对文件进行 js 相关的语言能力处理</span></span><br><span class="line">    useSameNameRequire: <span class="literal">true</span>,    <span class="comment">//开启同名依赖.@param: bool</span></span><br><span class="line">    requires:[    <span class="comment">//默认依赖的资源id表</span></span><br><span class="line">        <span class="string">''</span>static/lib/jquery.js<span class="string">''</span></span><br><span class="line">    ],</span><br><span class="line">    extras: &#123;    <span class="comment">//在[静态资源映射表][]中的附加数据，用于扩展[静态资源映射表][]表的功能。@param: object</span></span><br><span class="line">        isPage: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">fis.match(<span class="string">'/widget/mod.js'</span>, &#123;</span><br><span class="line">    packOrder: -<span class="number">100</span>,     <span class="comment">//用来控制合并时的顺序，值越小越在前面。配合 packTo 一起使用。@param:number</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">fis.match(<span class="string">'/widget/jquery.js'</span>, &#123;</span><br><span class="line">    <span class="comment">//使用 var $ = require('jquery');</span></span><br><span class="line">    id: <span class="string">'query'</span>,    <span class="comment">//指定文件的资源id。默认是 namespace + subpath 的值,@param: string</span></span><br><span class="line">    moduleId: <span class="string">'jquery'</span>,    <span class="comment">//指定文件资源的模块id。在插件fis3-hook-module里面自动包裹define的时候会用到，默认是 id 的值。@param: string</span></span><br><span class="line">    isMod: <span class="literal">true</span>    <span class="comment">//标示文件是否为组件化文件。@param: bool</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">fis.media(<span class="string">'prod'</span>).match(<span class="string">'*.css'</span>, &#123;</span><br><span class="line">    useHash: <span class="literal">true</span>,     <span class="comment">//是否携带md5戳。@param: true</span></span><br><span class="line">    domain: <span class="string">'http://www.qq.com'</span>,   <span class="comment">//给文件 URL 设置cdn替换前缀。@paran: string</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">fis.match(<span class="string">'*.less'</span>, &#123;</span><br><span class="line">    rExt: <span class="string">'.css'</span>    <span class="comment">//设置最终文件产出后的后缀.@param: string</span></span><br><span class="line">    userMap: <span class="literal">true</span>,    <span class="comment">//文件信息是否添加到 map.json,用于处理声明依赖，后面会讲到。@param: bool</span></span><br><span class="line">    </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ol>
<li>插件配置属性：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">fis.match(<span class="string">'*.js'</span>, &#123;</span><br><span class="line">    lint: fis.plugin(<span class="string">'js'</span>, &#123;    <span class="comment">//启用 lint 插件进行代码检查</span></span><br><span class="line"> </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">fis.match(<span class="string">'*.less'</span>, &#123;</span><br><span class="line">   parser: fis.plugin(<span class="string">'less'</span>), <span class="comment">//启用fis-parser-less插件</span></span><br><span class="line">   rExt: <span class="string">'.css'</span></span><br><span class="line">&#125;);</span><br><span class="line">fis.match(<span class="string">'*.sass'</span>, &#123;</span><br><span class="line">    parser: fis.plugin(<span class="string">'sass'</span>), <span class="comment">//启用fis-parser-sass插件</span></span><br><span class="line">    rExt: <span class="string">'.css'</span></span><br><span class="line">&#125;);</span><br><span class="line">fis.match(<span class="string">'*.&#123;css,less&#125;'</span>, &#123;</span><br><span class="line">    paser: fis.plugin(<span class="string">'image-set'</span>)</span><br><span class="line">&#125;);</span><br><span class="line">fis.match(<span class="string">'::package'</span>, &#123;</span><br><span class="line">    packager: fis.plugin(<span class="string">'map'</span>),</span><br><span class="line">    spriter: fis.plugin(<span class="string">'csssprites'</span>)</span><br><span class="line">&#125;);</span><br><span class="line">fis.media(<span class="string">'prod'</span>).match(<span class="string">'::package'</span>, &#123;</span><br><span class="line">    spriter: fis.plugin(<span class="string">'csssprites'</span>)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 发布部署等</span></span><br><span class="line">fis.match(<span class="string">'**'</span>, &#123;</span><br><span class="line">      deploy: fis.plugin(<span class="string">'http-push'</span>, &#123;</span><br><span class="line">          receiver: <span class="string">'http://target-host/receiver.php'</span>, <span class="comment">// 接收端</span></span><br><span class="line">          to: <span class="string">'/home/work/www'</span> <span class="comment">// 将部署到服务器的这个目录下</span></span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>当然更多插件可以查看 <a href="http://npmsearch.com/?q=fis-parser%20fis3-parser" target="_blank" rel="external">http://npmsearch.com/?q=fis-parser%20fis3-parser</a><br>通过插件我们就可以使用一些基础功能的组合了：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加 md5</span></span><br><span class="line">fis.match(<span class="string">'*.&#123;js,css,png&#125;'</span>, &#123;</span><br><span class="line">    useHash: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 启用 fis-spriter-csssprites 插件</span></span><br><span class="line">fis.match(<span class="string">'::package'</span>, &#123;</span><br><span class="line">    spriter: fis.plugin(<span class="string">'csssprites'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 对 CSS 进行图片合并</span></span><br><span class="line">fis.match(<span class="string">'*.css'</span>, &#123;</span><br><span class="line">    <span class="comment">// 给匹配到的文件分配属性 `useSprite`</span></span><br><span class="line">    useSprite: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">fis.match(<span class="string">'*.js'</span>, &#123;</span><br><span class="line">     <span class="comment">// fis-optimizer-uglify-js 插件进行压缩，已内置</span></span><br><span class="line">    optimizer: fis.plugin(<span class="string">'uglify-js'</span>)</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">fis.match(<span class="string">'*.css'</span>, &#123;</span><br><span class="line">    <span class="comment">// fis-optimizer-clean-css 插件进行压缩，已内置</span></span><br><span class="line">    optimizer: fis.plugin(<span class="string">'clean-css'</span>)</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">fis.match(<span class="string">'*.png'</span>, &#123;</span><br><span class="line">    <span class="comment">// fis-optimizer-png-compressor 插件进行压缩，已内置</span></span><br><span class="line">    optimizer: fis.plugin(<span class="string">'png-compressor'</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>如果开发阶段有时不需要那么多处理流程可以禁用某些功能：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fis.media(<span class="string">'debug'</span>).match(<span class="string">'*.&#123;js,css,png&#125;'</span>, &#123;</span><br><span class="line">    useHash: <span class="literal">false</span>,</span><br><span class="line">    useSprite: <span class="literal">false</span>,</span><br><span class="line">    optimizer: <span class="literal">null</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h3 id="u4E09_u3001_u8C03_u8BD5_u4E0E_u53D1_u5E03"><a href="#u4E09_u3001_u8C03_u8BD5_u4E0E_u53D1_u5E03" class="headerlink" title="三、调试与发布"></a>三、调试与发布</h3><p>FIS3 构建后，默认情况下会对资源的 URL 进行修改，改成绝对路径。同样FIS3 内置一个简易 Web Server，可以方便调试构建结果。</p>
<ul>
<li>1、开启server到内置server调试目录</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fis3 server open</span><br></pre></td></tr></table></figure>
<ul>
<li>2、发布到内置server发布目录</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fis3 release</span><br></pre></td></tr></table></figure>
<ul>
<li>3、文件监听</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fis3 release -w    <span class="comment">//FIS3 通过对 release 命令添加 -w 或者 --watch 参数启动文件监听功能。</span></span><br><span class="line">fis3 release -wL  <span class="comment">//文件修改自动构建发布了，如果浏览器能自动刷新。</span></span><br></pre></td></tr></table></figure>
<ul>
<li>4、发布配置<br>发布只需要配置就可以完成</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fis.match(<span class="string">'*'</span>, &#123;</span><br><span class="line">    deploy: fis.plugin(<span class="string">'http-push'</span>, &#123;</span><br><span class="line">        receiver: <span class="string">'http://cq.01.p.p.baidu.com:8888/receiver.php'</span>,</span><br><span class="line">        to: <span class="string">'/home/work/htdocs'</span> <span class="comment">// 注意这个是指的是测试机器的路径，而非本地机器</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="u56DB_u3001_u5185_u7F6E_u529F_u80FD"><a href="#u56DB_u3001_u5185_u7F6E_u529F_u80FD" class="headerlink" title="四、内置功能"></a>四、内置功能</h3><ul>
<li>4.1 嵌入资源<br>html和css中内嵌只需要在引用加载的文件后面加上__inline就可实现:</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">img</span> <span class="attribute">title</span>=<span class="value">"百度logo"</span> <span class="attribute">src</span>=<span class="value">"images/logo.gif?__inline"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">type</span>=<span class="value">"text/css"</span> <span class="attribute">href</span>=<span class="value">"demo.css?__inline"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"demo.js?__inline"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"import"</span> <span class="attribute">href</span>=<span class="value">"demo.html?__inline"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> @import url('demo.css?__inline');</span><br></pre></td></tr></table></figure>
<p>js中内嵌资源稍有点不同：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__inline(<span class="string">'demo.js'</span>);</span><br><span class="line"><span class="keyword">var</span> img = __inline(<span class="string">'images/logo.gif'</span>);</span><br><span class="line"><span class="keyword">var</span> css = __inline(<span class="string">'a.css'</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>4.2 资源定位<br>其实官方文档讲了很多，但很简单，主要是在没有inline的条件下将内嵌的资源处理后加上后缀，放入到相对应的发布目录中自动定位。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> img = __uri(<span class="string">'images/logo.gif'</span>);</span><br><span class="line"><span class="comment">// 处理后变成，其它的原理类似</span></span><br><span class="line"><span class="keyword">var</span> img = <span class="string">'/static/pic/logo_74e5229.gif'</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>4.3 声明依赖<br>html中声明依赖。用户可以在html的注释中声明依赖关系，这些依赖关系最终会被记录下来，当某个文件中包含字符 <strong>RESOURCE_MAP</strong> 那么这个记录会被字符串化后替换 <strong>RESOURCE_MAP</strong>。<br>例如index.html中含有并且设置了useMap：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">    @<span class="built_in">require</span> demo.js</span><br><span class="line">    @<span class="built_in">require</span> <span class="string">"demo.css"</span></span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//fis-conf.js</span></span><br><span class="line">fis.match(<span class="string">'*.html'</span>, &#123;</span><br><span class="line">    useMap: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>那么发布后会产生如下manifest.json文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"res"</span> : &#123;</span><br><span class="line">        <span class="string">"index.html"</span> : &#123;</span><br><span class="line">            <span class="string">"uri"</span> : <span class="string">"/index.html"</span>,</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"html"</span>,</span><br><span class="line">            <span class="string">"deps"</span> : [ <span class="string">"demo.js"</span>, <span class="string">"demo.css"</span> ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"pkg"</span> : &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样js和css中的配置方式和html中完全一致</p>
<h3 id="u4E94_u3001_u5DE5_u4F5C_u539F_u7406"><a href="#u4E94_u3001_u5DE5_u4F5C_u539F_u7406" class="headerlink" title="五、工作原理"></a>五、工作原理</h3><h4 id="1-__u6784_u5EFA_u6D41_u7A0B"><a href="#1-__u6784_u5EFA_u6D41_u7A0B" class="headerlink" title="1. 构建流程"></a>1. 构建流程</h4><p>FIS3 是基于文件对象进行构建的，每个进入 FIS3 的文件都会实例化成一个 File 对象，整个构建过程都对这个对象进行操作完成构建任务。一个文件的构建流程分为三个阶段：</p>
<ul>
<li>扫项目目录拿到文件并初始化出一个文件对象的列表，列表包含需要处理文件的文件对象</li>
<li>对文件对象中每一个文件进行单文件编译</li>
<li>获取用户设置的 package 插件，进行打包处理（包括合并图片）</li>
</ul>
<p>单文件进行处理的流程依次为：lint -&gt; parser -&gt; preprocessor -&gt; standard -&gt; postprocessor -&gt; optimizer。正如上面所配置的，这六个过程可以通过配置插件来定义我们最终想要的结果。例如，<br>lint 代码校验检查，比较特殊，所以需要 release 命令命令行添加 -l 参数<br>parser 预处理阶段，比如 less、sass、es6、react 前端模板等都在此处预编译处理<br>preprocessor 标准化前处理插件<br>standard 标准化插件，处理内置语法<br>postprocessor 标准化后处理插件</p>
<h3 id="2-_File_u5BF9_u8C61"><a href="#2-_File_u5BF9_u8C61" class="headerlink" title="2. File对象"></a>2. File对象</h3><p>当一个文件被实例化为一个 File 对象后，包括一些文件基本属性，如 filename、realpath 等等，当这个文件被处理时，FIS3 还会把用户自定义的属性 merge 到文件对象上。例如</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fis.match(<span class="string">'a.js'</span>, &#123;</span><br><span class="line">  myProp: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>fis将给这个a.js加上myPorp属性，有点类似与gulp的pipe处理。</p>
<h3 id="u516D_u3001_u7528fis3_u8FDB_u884C_u9879_u76EE_u5F00_u53D1"><a href="#u516D_u3001_u7528fis3_u8FDB_u884C_u9879_u76EE_u5F00_u53D1" class="headerlink" title="六、用fis3进行项目开发"></a>六、用fis3进行项目开发</h3><h4 id="1-__u63D2_u4EF6_u4F7F_u7528"><a href="#1-__u63D2_u4EF6_u4F7F_u7528" class="headerlink" title="1. 插件使用"></a>1. 插件使用</h4><p>npm install -g 插件名 可以用来安装fis插件，插件列表见 <a href="http://npmsearch.com/?q=fis-parser%20fis3-parser" target="_blank" rel="external">http://npmsearch.com/?q=fis-parser%20fis3-parser</a><br>配置调试使用见上文的配置，fis3内置的插件如下，有这些觉得基本可以用来开发一个正式项目了。<br>fis-optimizer-clean-css<br>fis-optimizer-png-compressor<br>fis-optimizer-uglify-js<br>fis-spriter-csssprites<br>fis3-deploy-local-deliver<br>fis3-deploy-http-push<br>fis3-hook-components<br>fis3-packager-map</p>
<p><a href="http://fis.baidu.com/fis3/docs/api/config-system-plugin.html" target="_blank" rel="external">http://fis.baidu.com/fis3/docs/api/config-system-plugin.html</a></p>
<h4 id="2-__u63D2_u4EF6_u7F16_u5199"><a href="#2-__u63D2_u4EF6_u7F16_u5199" class="headerlink" title="2. 插件编写"></a>2. 插件编写</h4><p>不到万不得已不要去扩展插件，用到的时候再说吧，fis3扩展了些插件，99%能满足开发需要。</p>
<h4 id="3-__u6A21_u5757_u5316_u5F00_u53D1"><a href="#3-__u6A21_u5757_u5316_u5F00_u53D1" class="headerlink" title="3. 模块化开发"></a>3. 模块化开发</h4><p>进行模块化开发首先安装npm install -g fis3-hook-module</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fis.hook(<span class="string">'module'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fis.hook(<span class="string">'module'</span>, &#123;</span><br><span class="line">    mode: <span class="string">'amd'</span>    <span class="comment">//这里支持amd和commonJs</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">fis.match(<span class="string">'/module/*.js'</span>, &#123;</span><br><span class="line">  isMod: <span class="literal">true</span> <span class="comment">// 标记匹配文件为组件</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="2-__u9879_u76EE_u5F00_u53D1_u57FA_u672C_u89C4_u8303"><a href="#2-__u9879_u76EE_u5F00_u53D1_u57FA_u672C_u89C4_u8303" class="headerlink" title="2. 项目开发基本规范"></a>2. 项目开发基本规范</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开发目录规范</span></span><br><span class="line">.</span><br><span class="line">├── page    <span class="comment">// 放置页面模板</span></span><br><span class="line">│   └── index.html</span><br><span class="line">├── static    <span class="comment">//公用静态资源</span></span><br><span class="line">│   └── lib    <span class="comment">//公用静态资源库。例如jquery、zepto等</span></span><br><span class="line">├── test    <span class="comment">//一些测试数据和用例</span></span><br><span class="line">└── widget    <span class="comment">//一切组件，包括模板、css、js、图片以及其他前端资源</span></span><br><span class="line">    ├── header</span><br><span class="line">    ├── nav</span><br><span class="line">    └── ui</span><br><span class="line"></span><br><span class="line"><span class="comment">//发布部署规范</span></span><br><span class="line">.</span><br><span class="line">├── static    <span class="comment">//所有的静态资源都放到这个目录下</span></span><br><span class="line">├── template    <span class="comment">//所有的模板都放到这个目录下</span></span><br><span class="line">└── test    还是一些测试数据、用例</span><br><span class="line"></span><br><span class="line"><span class="comment">//构建工具配置</span></span><br><span class="line">foo</span><br><span class="line">foo/bin/foo.js</span><br><span class="line">foo/index.js</span><br><span class="line">package.json</span><br></pre></td></tr></table></figure>
<p>基于 FIS3 配置目录规范和部署规范的配置文件编写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 所有的文件产出到 static/ 目录下</span></span><br><span class="line">fis.match(<span class="string">'*'</span>, &#123;</span><br><span class="line">    release: <span class="string">'/static/$0'</span></span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 所有模板放到 tempalte 目录下</span></span><br><span class="line">fis.match(<span class="string">'*.html'</span>, &#123;</span><br><span class="line">    release: <span class="string">'/template/$0'</span></span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// widget源码目录下的资源被标注为组件</span></span><br><span class="line">fis.match(<span class="string">'/widget/**/*'</span>, &#123;</span><br><span class="line">    isMod: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// widget下的 js 调用 jswrapper 进行自动化组件化封装</span></span><br><span class="line">fis.match(<span class="string">'/widget/**/*.js'</span>, &#123;</span><br><span class="line">    postprocessor: fis.plugin(<span class="string">'jswrapper'</span>, &#123;</span><br><span class="line">        type: <span class="string">'commonjs'</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// test 目录下的原封不动产出到 test 目录下</span></span><br><span class="line">fis.match(<span class="string">'/test/**/*'</span>, &#123;</span><br><span class="line">    release: <span class="string">'$0'</span></span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// optimize</span></span><br><span class="line">fis.media(<span class="string">'prod'</span>)</span><br><span class="line">    .match(<span class="string">'*.js'</span>, &#123;</span><br><span class="line">        optimizer: fis.plugin(<span class="string">'uglify-js'</span>, &#123;</span><br><span class="line">            mangle: &#123;</span><br><span class="line">                expect: [<span class="string">'require'</span>, <span class="string">'define'</span>, <span class="string">'some string'</span>] <span class="comment">//不想被压的</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    .match(<span class="string">'*.css'</span>, &#123;</span><br><span class="line">        optimizer: fis.plugin(<span class="string">'clean-css'</span>, &#123;</span><br><span class="line">            <span class="string">'keepBreaks'</span>: <span class="literal">true</span> <span class="comment">//保持一个规则一个换行</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// pack</span></span><br><span class="line">fis.media(<span class="string">'prod'</span>)</span><br><span class="line">    <span class="comment">// 启用打包插件，必须匹配 ::package</span></span><br><span class="line">    .match(<span class="string">'::package'</span>, &#123;</span><br><span class="line">        packager: fis.plugin(<span class="string">'map'</span>),</span><br><span class="line">        spriter: fis.plugin(<span class="string">'csssprites'</span>, &#123;</span><br><span class="line">            layout: <span class="string">'matrix'</span>,</span><br><span class="line">            margin: <span class="string">'15'</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    .match(<span class="string">'*.js'</span>, &#123;</span><br><span class="line">        packTo: <span class="string">'/static/all_others.js'</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .match(<span class="string">'*.css'</span>, &#123;</span><br><span class="line">        packTo: <span class="string">'/staitc/all_others.js'</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .match(<span class="string">'/widget/**/*.js'</span>, &#123;</span><br><span class="line">        packTo: <span class="string">'/static/all_comp.js'</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .match(<span class="string">'/widget/**/*.css'</span>, &#123;</span><br><span class="line">        packTo: <span class="string">'/static/all_comp.css'</span></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>实现 /bin/foo.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vi foo/bin/foo.js</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> Liftoff = <span class="built_in">require</span>(<span class="string">'liftoff'</span>);</span><br><span class="line"><span class="keyword">var</span> argv = <span class="built_in">require</span>(<span class="string">'minimist'</span>)(process.argv.slice(<span class="number">2</span>));</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">var</span> cli = <span class="keyword">new</span> Liftoff(&#123;</span><br><span class="line">  name: <span class="string">'foo'</span>, <span class="comment">// 命令名字</span></span><br><span class="line">  processTitle: <span class="string">'foo'</span>,</span><br><span class="line">  moduleName: <span class="string">'foo'</span>,</span><br><span class="line">  configName: <span class="string">'fis-conf'</span>,</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// only js supported!</span></span><br><span class="line">  extensions: &#123;</span><br><span class="line">    <span class="string">'.js'</span>: <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">cli.launch(&#123;</span><br><span class="line">  cwd: argv.r || argv.root,</span><br><span class="line">  configPath: argv.f || argv.file</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">env</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> fis;</span><br><span class="line">  <span class="keyword">if</span> (!env.modulePath) &#123;</span><br><span class="line">    fis = <span class="built_in">require</span>(<span class="string">'../'</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fis = <span class="built_in">require</span>(env.modulePath);</span><br><span class="line">  &#125;</span><br><span class="line">  fis.set(<span class="string">'system.localNPMFolder'</span>, path.join(env.cwd, <span class="string">'node_modules/foo'</span>));</span><br><span class="line">  fis.set(<span class="string">'system.globalNPMFolder'</span>, path.dirname(__dirname));</span><br><span class="line">  fis.cli.run(argv, env);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="u4E03_u3001_u5FC5_u987B_u638C_u63E1_u7684"><a href="#u4E03_u3001_u5FC5_u987B_u638C_u63E1_u7684" class="headerlink" title="七、必须掌握的"></a>七、必须掌握的</h3><p>命令行 fis3 <command> : </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fis3 release [-d path]     <span class="comment">//发布目录</span></span><br><span class="line">fis3 install 插件名        <span class="comment">//安装一个插件</span></span><br><span class="line">fis3 init     <span class="comment">//初始化一个项目</span></span><br><span class="line">fis3 server [start | stop | restart | open | info ]      <span class="comment">//内置服务器操作</span></span><br><span class="line">fis3 inspect     <span class="comment">//比较实用的命令，用来查看文件 match 结果</span></span><br></pre></td></tr></table></figure>
<p>大概fis3文档的内容全部覆盖了，只有插件编写没有去深究。感觉整体能应对我们平时遇到的99%的问题。后面也靠fis团队更新插件了，至于缺少方便的插件的开发环境这点，个人觉得不到万不得已不要自己去造轮子，fis2很多插件缺少可以理解，后面还是尽量不要自己去造插件了。</p>

          
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/08/06/ouvens.github.io/frontend-css/2014-08-06-css-get-rid-of-gap/" itemprop="url">
                  css清除元素间距
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-08-06T00:00:00+08:00" content="2015-08-06">
              2015-08-06
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/frontend-css/" itemprop="url" rel="index">
                    <span itemprop="name">frontend-css</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/08/06/ouvens.github.io/frontend-css/2014-08-06-css-get-rid-of-gap/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/08/06/ouvens.github.io/frontend-css/2014-08-06-css-get-rid-of-gap/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="u73B0_u8C61_u63CF_u8FF0"><a href="#u73B0_u8C61_u63CF_u8FF0" class="headerlink" title="现象描述"></a>现象描述</h3><p>真正意义上的inline-block水平呈现的元素间，换行显示或空格分隔的情况下会有间距，很简单的个例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">input</span> /&gt;</span> <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"submit"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们使用CSS更改非inline-block水平元素为inline-block水平，也会有该问题：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.space a &#123;</span><br><span class="line">    display: inline-block;</span><br><span class="line">    padding: .5em 1em;</span><br><span class="line">    background-color: #cad5eb;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"space"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"##"</span>&gt;</span>惆怅<span class="tag">&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"##"</span>&gt;</span>淡定<span class="tag">&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"##"</span>&gt;</span>热血<span class="tag">&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这种表现是符合规范的应该有的表现（如果有人认为是bug就太严重了）。<br>不过，这类间距有时会对我们布局，或是兼容性处理产生影响，需要去掉它，该怎么办呢？以下展示N种方法（欢迎补充）！</p>
<h3 id="u65B9_u6CD5_u4E00_u3001_u79FB_u9664_u7A7A_u683C"><a href="#u65B9_u6CD5_u4E00_u3001_u79FB_u9664_u7A7A_u683C" class="headerlink" title="方法一、移除空格"></a>方法一、移除空格</h3><p>元素间留白间距出现的原因就是标签段之间的空格，因此，去掉HTML中的空格，自然间距就木有了。考虑到代码可读性，显然连成一行的写法是不可取的，我们可以：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"space"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"##"</span>&gt;</span></span><br><span class="line">    惆怅<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"##"</span>&gt;</span></span><br><span class="line">    淡定<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"##"</span>&gt;</span></span><br><span class="line">    热血<span class="tag">&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>或者是：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"space"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"##"</span>&gt;</span>惆怅<span class="tag">&lt;/<span class="title">a</span></span><br><span class="line">    &gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"##"</span>&gt;</span>淡定<span class="tag">&lt;/<span class="title">a</span></span><br><span class="line">    &gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"##"</span>&gt;</span>热血<span class="tag">&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>或者是借助HTML注释：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"space"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"##"</span>&gt;</span>惆怅<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="comment">&lt;!--</span><br><span class="line">    --&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"##"</span>&gt;</span>淡定<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="comment">&lt;!--</span><br><span class="line">    --&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"##"</span>&gt;</span>热血<span class="tag">&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="u65B9_u6CD5_u4E8C_u3001_u4F7F_u7528margin_u8D1F_u503C"><a href="#u65B9_u6CD5_u4E8C_u3001_u4F7F_u7528margin_u8D1F_u503C" class="headerlink" title="方法二、使用margin负值"></a>方法二、使用margin负值</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.space</span> <span class="tag">a</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">display</span>:<span class="value"> inline-block</span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">margin-right</span>:<span class="value"> -<span class="number">3px</span></span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>margin负值的大小与上下文的字体和文字大小相关，其中，间距对应大小值可以参见我之前“基于display:inline-block的列表布局”一文part 6的统计表格：</p>
<p>例如，对于12像素大小的上下文，Arial字体的margin负值为-3像素，Tahoma和Verdana就是-4像素，而Geneva为-6像素。<br>由于外部环境的不确定性，以及最后一个元素多出的父margin值等问题，这个方法不适合大规模使用。</p>
<h3 id="u65B9_u6CD5_u4E09_u3001_u8BA9_u95ED_u5408_u6807_u7B7E_u5403_u80F6_u56CA"><a href="#u65B9_u6CD5_u4E09_u3001_u8BA9_u95ED_u5408_u6807_u7B7E_u5403_u80F6_u56CA" class="headerlink" title="方法三、让闭合标签吃胶囊"></a>方法三、让闭合标签吃胶囊</h3><p>如下处理：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"space"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"##"</span>&gt;</span>惆怅</span><br><span class="line">    <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"##"</span>&gt;</span>淡定</span><br><span class="line">    <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"##"</span>&gt;</span>热血<span class="tag">&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意，为了向下兼容IE6/IE7等喝蒙牛长大的浏览器，最后一个列表的标签的结束（闭合）标签不能丢。<br>在HTML5中，我们直接：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"space"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"##"</span>&gt;</span>惆怅</span><br><span class="line">    <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"##"</span>&gt;</span>淡定</span><br><span class="line">    <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"##"</span>&gt;</span>热血</span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>好吧，虽然感觉上有点怪怪的，但是，这是OK的。<br>您可以狠狠地点击这里：无闭合标签去除inline-block元素间距demo</p>
<h3 id="u65B9_u6CD5_u56DB_u3001_u4F7F_u7528font-size_3A0"><a href="#u65B9_u6CD5_u56DB_u3001_u4F7F_u7528font-size_3A0" class="headerlink" title="方法四、使用font-size:0"></a>方法四、使用font-size:0</h3><p>类似下面的代码：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.space</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">0</span></span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"><span class="class">.space</span> <span class="tag">a</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">12px</span></span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>这个方法，基本上可以解决大部分浏览器下inline-block元素之间的间距(IE7等浏览器有时候会有1像素的间距)。不过有个浏览器，就是Chrome, 其默认有最小字体大小限制，因为，考虑到兼容性，我们还需要添加：<br>类似下面的代码：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.space</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">0</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">-webkit-text-size-adjust</span>:<span class="value">none</span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>您可以狠狠地点击这里（去年制作的一个简单demo）：font-size:0清除换行符间隙demo<br>补充：根据小杜在评论中中的说法，目前Chrome浏览器已经取消了最小字体限制。因此，上面的-webkit-text-size-adjust:none;代码估计时日不多了。</p>
<h3 id="u65B9_u6CD5_u4E94_u3001_u4F7F_u7528letter-spacing"><a href="#u65B9_u6CD5_u4E94_u3001_u4F7F_u7528letter-spacing" class="headerlink" title="方法五、使用letter-spacing"></a>方法五、使用letter-spacing</h3><p>类似下面的代码：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.space</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">letter-spacing</span>:<span class="value"> -<span class="number">3px</span></span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"><span class="class">.space</span> <span class="tag">a</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">letter-spacing</span>:<span class="value"> <span class="number">0</span></span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>根据我去年的测试，该方法可以搞定基本上所有浏览器，包括吃“东鞋”、“西毒(胶囊)”、“南地(沟油)”、“北钙(三鹿)”的IE6/IE7浏览器，不过Opera浏览器下有蛋疼的问题：最小间距1像素，然后，letter-spacing再小就还原了。</p>
<h3 id="u65B9_u6CD5_u516D_u3001_u4F7F_u7528word-spacing"><a href="#u65B9_u6CD5_u516D_u3001_u4F7F_u7528word-spacing" class="headerlink" title="方法六、使用word-spacing"></a>方法六、使用word-spacing</h3><p>类似下面代码：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.space</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">word-spacing</span>:<span class="value"> -<span class="number">6px</span></span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"><span class="class">.space</span> <span class="tag">a</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">word-spacing</span>:<span class="value"> <span class="number">0</span></span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>一个是字符间距(letter-spacing)一个是单词间距(word-spacing)，大同小异。据我测试，word-spacing的负值只要大到一定程度，其兼容性上的差异就可以被忽略。因为，貌似，word-spacing即使负值很大，也不会发生重叠。<br>您可以狠狠地点击这里：word-spacing与元素间距去除demo<br>与上面demo一样的效果，这里就不截图展示了。如果您使用Chrome浏览器，可能看到的是间距依旧存在。确实是有该问题，原因我是不清楚，不过我知道，可以添加display: table;或display:inline-table;让Chrome浏览器也变得乖巧。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.space</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">display</span>:<span class="value"> inline-table</span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">word-spacing</span>:<span class="value"> -<span class="number">6px</span></span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="u65B9_u6CD5_u4E03_u3001_u5176_u4ED6_u6210_u54C1_u65B9_u6CD5"><a href="#u65B9_u6CD5_u4E03_u3001_u5176_u4ED6_u6210_u54C1_u65B9_u6CD5" class="headerlink" title="方法七、其他成品方法"></a>方法七、其他成品方法</h3><p>下面展示的是YUI 3 CSS Grids 使用letter-spacing和word-spacing去除格栅单元见间隔方法（注意，其针对的是block水平的元素，因此对IE8-浏览器做了hack处理）：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.yui3-g &#123;</span><br><span class="line">    letter-spacing: -0.31em; /* webkit */</span><br><span class="line">    *letter-spacing: normal; /* IE &lt; 8 重置 */</span><br><span class="line">    word-spacing: -0.43em; /* IE &lt; 8 &amp;&amp; gecko */</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.yui3-u &#123;</span><br><span class="line">    display: inline-block;</span><br><span class="line">    zoom: 1; *display: inline; /* IE &lt; 8: 伪造 inline-block */</span><br><span class="line">    letter-spacing: normal;</span><br><span class="line">    word-spacing: normal;</span><br><span class="line">    vertical-align: top;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以下是一个名叫RayM的人提供的方法：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">li &#123;</span><br><span class="line">    display:inline-block;</span><br><span class="line">    background: orange;</span><br><span class="line">    padding:10px;</span><br><span class="line">    word-spacing:0;</span><br><span class="line">    &#125;</span><br><span class="line">ul &#123;</span><br><span class="line">    width:100%;</span><br><span class="line">    display:table;  /* 调教webkit*/</span><br><span class="line">    word-spacing:-1em;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.nav li &#123; *display:inline;&#125;</span><br></pre></td></tr></table></figure>
<p>也就是上面一系列CSS方法的组合。</p>
<h3 id="u65B9_u6CD5_u516B_u3001_u4F7F_u7528float_3Aleft"><a href="#u65B9_u6CD5_u516B_u3001_u4F7F_u7528float_3Aleft" class="headerlink" title="方法八、使用float:left"></a>方法八、使用float:left</h3><p>类似下面代码：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.space</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">float</span>:<span class="value">left</span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="u7ED3_u8BED"><a href="#u7ED3_u8BED" class="headerlink" title="结语"></a>结语</h3><p>其他去除间距的方法肯定还有，欢迎大家通过评论方式进行补充。上文部分方法可能有测试不周全之处，因此，部分细节上可能会有纰漏，欢迎指正。<br>参考文章：Fighting the Space Between Inline Block Elements</p>

          
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/07/24/ouvens.github.io/frontend-javascript/2015-07-24-shadow-dom/" itemprop="url">
                  shadow dom解析
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-07-24T00:00:00+08:00" content="2015-07-24">
              2015-07-24
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/frontend-javascript/" itemprop="url" rel="index">
                    <span itemprop="name">frontend-javascript</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/07/24/ouvens.github.io/frontend-javascript/2015-07-24-shadow-dom/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/07/24/ouvens.github.io/frontend-javascript/2015-07-24-shadow-dom/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-shadowdom_u89E3_u6790"><a href="#1-shadowdom_u89E3_u6790" class="headerlink" title="1.shadowdom解析"></a>1.shadowdom解析</h1><h5 id="1-1__u4EC0_u4E48_u662Fshadow_dom"><a href="#1-1__u4EC0_u4E48_u662Fshadow_dom" class="headerlink" title="1.1 什么是shadow  dom"></a>1.1 什么是shadow  dom</h5><p>先看个例子:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">video</span> <span class="attribute">controls</span> <span class="attribute">autoplay</span> <span class="attribute">name</span>=<span class="value">"media"</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="title">source</span> <span class="attribute">id</span>=<span class="value">"mp4"</span> <span class="attribute">src</span>=<span class="value">"http://media.w3.org/2010/05/sintel/trailer.mp4"</span> <span class="attribute">type</span>=<span class="value">"video/mp4"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">video</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这样一个标签可以在浏览器产生几个界面你相对较复杂的播放器，怎么做到的?<br>&emsp;&emsp;为了理解问题，可以选择chrome设置里面的show userAgent shawdow，就可以看到shadow dom里的内容。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">video</span> <span class="attribute">src</span>=<span class="value">"a.mp4"</span> <span class="attribute">width</span>=<span class="value">"480"</span> <span class="attribute">height</span>=<span class="value">"360"</span>&gt;</span></span><br><span class="line">    #shadow root</span><br><span class="line">    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">pseudo</span>=<span class="value">"-webkit-media-controls"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">div</span> <span class="attribute">pseudo</span>=<span class="value">"-webkit-media-controls-overlay-enclosure"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"button"</span> <span class="attribute">style</span>=<span class="value">"display: none;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">div</span> <span class="attribute">pseudo</span>=<span class="value">"-webkit-media-controls-enclosure"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">div</span> <span class="attribute">pseudo</span>=<span class="value">"-webkit-media-controls-panel"</span> <span class="attribute">style</span>=<span class="value">"display: none;"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"button"</span> <span class="attribute">pseudo</span>=<span class="value">"-webkit-media-controls-play-button"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"range"</span> <span class="attribute">step</span>=<span class="value">"any"</span> <span class="attribute">pseudo</span>=<span class="value">"-webkit-media-controls-timeline"</span> <span class="attribute">max</span>=<span class="value">"0"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">div</span> <span class="attribute">pseudo</span>=<span class="value">"-webkit-media-controls-current-time-display"</span> <span class="attribute">style</span>=<span class="value">"display: none;"</span>&gt;</span>0:00<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">div</span> <span class="attribute">pseudo</span>=<span class="value">"-webkit-media-controls-time-remaining-display"</span>&gt;</span>0:00<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"button"</span> <span class="attribute">pseudo</span>=<span class="value">"-webkit-media-controls-mute-button"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"range"</span> <span class="attribute">step</span>=<span class="value">"any"</span> <span class="attribute">max</span>=<span class="value">"1"</span> <span class="attribute">pseudo</span>=<span class="value">"-webkit-media-controls-volume-slider"</span> <span class="attribute">style</span>=<span class="value">"display: none;"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"button"</span> <span class="attribute">pseudo</span>=<span class="value">"-webkit-media-controls-toggle-closed-captions-button"</span> <span class="attribute">style</span>=<span class="value">"display: none;"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"button"</span> <span class="attribute">style</span>=<span class="value">"display: none;"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"button"</span> <span class="attribute">pseudo</span>=<span class="value">"-webkit-media-controls-fullscreen-button"</span> <span class="attribute">style</span>=<span class="value">"display: none;"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">video</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;shadow-root里面的内容就是所有视频播放器控制组件的所在之处，css也可以看到，可见video标签内部也是很多个div和input形成的。<br>&emsp;&emsp;另外浏览器之所以将其置灰，是为了表明这部分是在 shadow DOM 里，对于页面的其他部分来说它是 不可用的 。这里的 不可用 意味着你写的 CSS 选择器和 JavaScript 代码都不会影响到这部分内容。实际上，就是让video 标签的逻辑和样式都被浏览器封装了。</p>
<h4 id="1-2__u5C0F_u7ED3"><a href="#1-2__u5C0F_u7ED3" class="headerlink" title="1.2 小结"></a>1.2 小结</h4><p>######小结下，Shadow DOM 是一个 HTML 的规范，其允许开发者封装自己的 HTML 标签、CSS 样式和 JavaScript 代码。也使得开发人员可以创建诸如 video这样自定义的一级标签。总的来说，这些新标签和相关的 API 被称为 Web Components。</p>
<p>&emsp;&emsp;关于shadow 都没有些概念可以理解下，上面shadow root是shadow dom的根节点；shadow tree为这个show dom包含的节点树，div和input等；shadow host称为shadow dom的容器元素，即video</p>
<h1 id="2-_u5982_u4F55_u521B_u5EFAshadow_dom"><a href="#2-_u5982_u4F55_u521B_u5EFAshadow_dom" class="headerlink" title="2.如何创建shadow dom"></a>2.如何创建shadow dom</h1><p>&emsp;&emsp;指定一个元素可以使用createShadowRoot方法创建一个shadow root，shadow root上可以任意通过dom操作添加shadow tree，同时制定样式和处理的逻辑，并将自己的api暴露出去。<br>完成创建后需要通过registerElement来注册元素。<br>（不过需要注意的是，目前支持chrome31、android4.4以上版本）<br>下面看个示例，是实现一个图文组合的组件功能：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="doctype">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"utf-8"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">title</span>&gt;</span>图文组合插件<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导入组件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">link</span> <span class="attribute">href</span>=<span class="value">"./image.html"</span> <span class="attribute">rel</span>=<span class="value">"import"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">x-image</span> <span class="attribute">src</span>=<span class="value">"http://9.url.cn/edu/banner/img/aa73d17e_760_300.jpg"</span> <span class="attribute">width</span>=<span class="value">"320"</span> <span class="attribute">height</span>=<span class="value">"150"</span> <span class="attribute">alt</span>=<span class="value">"banner自定义文本"</span>&gt;</span><span class="tag">&lt;/<span class="title">x-image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>组价模板的代码文件如下</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 定义组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">template</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 组件模板 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">style</span>&gt;</span><span class="css"></span><br><span class="line">        <span class="comment">/* shadow host内容 */</span></span><br><span class="line">        <span class="pseudo">:host</span> <span class="rules">&#123;</span><br><span class="line">            <span class="rule"><span class="attribute">display</span>:<span class="value"> block</span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">font</span>:<span class="value"> <span class="number">16px</span> monospace</span></span>;</span><br><span class="line">        &#125;</span></span><br><span class="line">        <span class="class">.banner-section</span><span class="rules">&#123;</span><br><span class="line">            <span class="rule"><span class="attribute">margin</span>:<span class="value"> <span class="number">0</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">padding</span>:<span class="value"> <span class="number">0</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100%</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">display</span>:<span class="value"> block</span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">position</span>:<span class="value"> relative</span></span>;</span><br><span class="line">        &#125;</span></span><br><span class="line">        <span class="class">.banner-section</span> <span class="class">.banner-image</span><span class="rules">&#123;</span><br><span class="line">            <span class="rule"><span class="attribute">margin</span>:<span class="value"> <span class="number">0</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">padding</span>:<span class="value"> <span class="number">0</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100%</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">100%</span></span></span>;</span><br><span class="line">        &#125;</span></span><br><span class="line">        <span class="class">.banner-section</span> <span class="class">.banner-text</span><span class="rules">&#123;</span><br><span class="line">            <span class="rule"><span class="attribute">display</span>:<span class="value"> block</span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">position</span>:<span class="value"> absolute</span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">bottom</span>:<span class="value"> <span class="number">0</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">left</span>:<span class="value"> <span class="number">0</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">right</span>:<span class="value"> <span class="number">0</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">padding</span>:<span class="value"> <span class="number">10px</span> <span class="number">5px</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#fff</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">background</span>:<span class="value"> <span class="function">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0.5</span>)</span></span>;</span><br><span class="line">        &#125;</span></span><br><span class="line">        <span class="class">.banner-section</span> <span class="class">.banner-text</span><span class="pseudo">:hover</span><span class="rules">&#123;</span><br><span class="line">            <span class="rule"><span class="attribute">cursor</span>:<span class="value"> pointer</span></span>;</span><br><span class="line">        &#125;</span></span><br><span class="line">    </span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"banner-section"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"banner-image"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">img</span> <span class="attribute">class</span>=<span class="value">'image'</span> <span class="attribute">src</span>=<span class="value">""</span> <span class="attribute">alt</span>=<span class="value">"image"</span> <span class="attribute">height</span>=<span class="value">"200"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"banner-text"</span>&gt;</span>MM<span class="tag">&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span><br><span class="line">    <span class="comment">// 在本文件被导入后自动执行</span></span><br><span class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params">thisDoc</span>) </span>&#123;</span><br><span class="line"><span class="pi">        "use strict"</span>; <span class="comment">// 启用严格模式</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 所有实例元素对象的公共prototype</span></span><br><span class="line">        <span class="keyword">var</span> XImage = <span class="built_in">Object</span>.create(HTMLElement.prototype, &#123;</span><br><span class="line">            height: &#123;</span><br><span class="line">                get: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>._height; &#125;,</span><br><span class="line">                set: <span class="function"><span class="keyword">function</span>(<span class="params">height</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">this</span>._height = height;</span><br><span class="line">                    <span class="keyword">this</span>._innerBanner.style.height = height + <span class="string">'px'</span>;</span><br><span class="line">                    <span class="keyword">this</span>._innerBanner.querySelector(<span class="string">'.image'</span>).style.height = height +<span class="string">'px'</span>;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            width: &#123;</span><br><span class="line">                get: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>._width; &#125;,</span><br><span class="line">                set: <span class="function"><span class="keyword">function</span>(<span class="params">width</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">this</span>._width = width;</span><br><span class="line">                    <span class="keyword">this</span>._innerBanner.style.width = width + <span class="string">'px'</span>;</span><br><span class="line">                    <span class="keyword">this</span>._innerBanner.querySelector(<span class="string">'.image'</span>).style.width = width +<span class="string">'px'</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            alt: &#123;</span><br><span class="line">                get: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>._width; &#125;,</span><br><span class="line">                set: <span class="function"><span class="keyword">function</span>(<span class="params">alt</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">this</span>._alt = alt;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">this</span>._innerBanner.querySelector(<span class="string">'.banner-text'</span>).innerHTML = alt;</span><br><span class="line">                    <span class="keyword">this</span>._innerBanner.querySelector(<span class="string">'.image'</span>).setAttribute(<span class="string">'alt'</span>, alt);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            src: &#123;</span><br><span class="line">                get: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>._src; &#125;,</span><br><span class="line">                set: <span class="function"><span class="keyword">function</span>(<span class="params">src</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">this</span>._src = src;</span><br><span class="line">                    <span class="keyword">this</span>._innerBanner.querySelector(<span class="string">'.image'</span>).setAttribute(<span class="string">'src'</span>, src);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 组件被创建时执行，相当于构造函数</span></span><br><span class="line">        XImage.createdCallback = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="comment">// 创建Shadow root，自定义模板放入其中</span></span><br><span class="line">            <span class="keyword">var</span> sr = <span class="keyword">this</span>.createShadowRoot();</span><br><span class="line">            <span class="keyword">var</span> template = thisDoc.querySelector(<span class="string">"template"</span>);</span><br><span class="line">            <span class="keyword">var</span> node = <span class="built_in">document</span>.importNode(template.content, <span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">this</span>._innerBanner = node.querySelector(<span class="string">".banner-section"</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">var</span> height = <span class="keyword">this</span>._height || <span class="built_in">Number</span>(<span class="keyword">this</span>.getAttribute(<span class="string">"height"</span>)),</span><br><span class="line">                width = <span class="keyword">this</span>._width || <span class="built_in">Number</span>(<span class="keyword">this</span>.getAttribute(<span class="string">"width"</span>)),</span><br><span class="line">                alt = <span class="keyword">this</span>._alt || <span class="built_in">String</span>(<span class="keyword">this</span>.getAttribute(<span class="string">'alt'</span>)),</span><br><span class="line">                src = <span class="keyword">this</span>._src || <span class="built_in">String</span>(<span class="keyword">this</span>.getAttribute(<span class="string">'src'</span>));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">isNaN</span>(height) || !<span class="built_in">isNaN</span>(width)) &#123;</span><br><span class="line">                <span class="keyword">this</span>.height = height;</span><br><span class="line">                <span class="keyword">this</span>.width = width;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(alt)&#123;</span><br><span class="line">                <span class="keyword">this</span>.alt = alt;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">this</span>.src = src;</span><br><span class="line">            sr.appendChild(node);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 注册组件</span></span><br><span class="line">        <span class="built_in">document</span>.registerElement(<span class="string">"x-image"</span>, &#123; prototype: XImage &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;)(<span class="built_in">document</span>.currentScript.ownerDocument); <span class="comment">// ownerDocument指向被导入的文档对象（本文件）</span></span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>html中使用html import方式引入外部的shadow dom内容，在支持shadow dom的浏览器上显示如下效果，同时在自定义的组件里可以按照自己的需要向外暴露可配置属性和webApi接口。</p>
<p><img src="http://7tszky.com1.z0.glb.clouddn.com/FvIroGHVjTDqvFRPu0i1vgg0y2a2" alt=""></p>
<p>参考：</p>
<p><a href="http://soledadpenades.com/2014/01/02/shadow-dom-in-firefox/" target="_blank" rel="external">http://soledadpenades.com/2014/01/02/shadow-dom-in-firefox/</a></p>
<p><a href="http://www.w3.org/TR/shadow-dom/" target="_blank" rel="external">http://www.w3.org/TR/shadow-dom/</a></p>

          
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/06/18/ouvens.github.io/frontend-client/2015-06-18-nativescript-app-dev/" itemprop="url">
                  Nativescript跨终端应用程序开发方案研究
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-06-18T00:00:00+08:00" content="2015-06-18">
              2015-06-18
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/frontend-client/" itemprop="url" rel="index">
                    <span itemprop="name">frontend-client</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/06/18/ouvens.github.io/frontend-client/2015-06-18-nativescript-app-dev/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/06/18/ouvens.github.io/frontend-client/2015-06-18-nativescript-app-dev/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-_u73AF_u5883_u51C6_u5907"><a href="#1-_u73AF_u5883_u51C6_u5907" class="headerlink" title="1.环境准备"></a>1.环境准备</h3><ul>
<li>安装nodejs</li>
<li>安装nativescript</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$npm install -g nativescript</span><br></pre></td></tr></table></figure>
<p>或者下载github上项目代码进行构建(不推荐)</p>
<ul>
<li>安装java JDK<br>jdk是Java运行开发环境，按android开发必须的开发的环境</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">JAVA_HOME   D:<span class="regexp">/program file/</span>java/jdk_1<span class="number">.7</span><span class="number">.34</span>/</span><br><span class="line">path         D:<span class="regexp">/program file/</span>java/jdk_1<span class="number">.7</span><span class="number">.34</span>/bin</span><br><span class="line">classpath   D:<span class="regexp">/program file/</span>java/jdk_1<span class="number">.7</span><span class="number">.34</span>/lib</span><br></pre></td></tr></table></figure>
<p>测试方法：java -version</p>
<ul>
<li>安装Apache ant<br>Apache Ant,是一个将软件编译、测试、部署等步骤联系在一起加以自动化的一个工具，大多用于Java环境中的软件开发。由Apache软件基金会所提供。这里用到的的是用于android签名证书等打包(android开发过程中ide使用gradle配置打包，早期都是用的ant打包，这里使用的方法比较原始)<br><a href="http://ant.apache.org/bindownload.cgi" target="_blank" rel="external">http://ant.apache.org/bindownload.cgi</a> 上下载最新版apache-bin(可选择安装型或压缩包型)，然后添加系统环境变量</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ANT_HOME    C:/ apache-ant-1.9.5</span><br><span class="line">path        C:/ apache-ant-1.9.5/bin</span><br><span class="line">classpath   C:/apache-ant-1.9.5/lib</span><br></pre></td></tr></table></figure>
<p>测试方法：ant -version</p>
<ul>
<li>安装Android sdk<br>下载最新的adk，<a href="http://developer.android.com/sdk/installing/index.html" target="_blank" rel="external">http://developer.android.com/sdk/installing/index.html</a> 下载后解压到某个目录(例如D盘)，然后添加系统环境变量</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ANDROID_HOME   D:/android-sdk-windows</span><br><span class="line">path        D:/android\android-sdk-windows\tools</span><br><span class="line">classpath  D:/android\android-sdk-windows\tools\lib</span><br></pre></td></tr></table></figure>
<p>测试方法：android<br>必须掌握的两个命令：abd start-server/ adb kill-server，用于启动android debug服务，adb使用与启动模拟器或是通过手机的自动安装调试，并可以看到log信息。这两个命令会经常用到<br>然后 命令行运行一下tns，如果看到以下提示信息，就可以开始第一个开发了。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># NativeScript</span><br><span class="line">┌─────────┬─────────────────────────────</span><br><span class="line">───────────────────────────────────┐</span><br><span class="line">│ Usage   │ Synopsis                                                       │</span><br><span class="line">│ General │ $ tns &lt;Command&gt; [Command Parameters] [--command &lt;Options&gt;]     │</span><br><span class="line">│ Alias   │ $ nativescript &lt;Command&gt; [Command Parameters] [--command       │</span><br><span class="line">│         │ &lt;Options&gt;]                                                     │</span><br><span class="line">└─────────┴─────────────────────────────</span><br><span class="line">───────────────────────────────────┘</span><br></pre></td></tr></table></figure>
<h3 id="2-_u5F00_u59CB_u9879_u76EE"><a href="#2-_u5F00_u59CB_u9879_u76EE" class="headerlink" title="2.开始项目"></a>2.开始项目</h3><ul>
<li>创建项目</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ tns create demo</span><br><span class="line">$ cd demo</span><br><span class="line">$ tns platform add andrdoi/ios</span><br><span class="line">├── app     <span class="comment">// bower dependencies</span></span><br><span class="line">        ├── App_Resources    <span class="comment">// bower dependencies</span></span><br><span class="line">                        ├── Android  <span class="comment">// android项目的drawble静态图片等文件，项目转换的时候直接拷贝到android项目下</span></span><br><span class="line">                        ├── iOS        <span class="comment">//ios项目用到的图片文件</span></span><br><span class="line">        ├── tns_modules    <span class="comment">//tns node模块，可以用来调用移动设备功能</span></span><br><span class="line">        ├── app.css    <span class="comment">// 内部控件样式</span></span><br><span class="line">        ├── app.js    <span class="comment">// 页面配置入口配置</span></span><br><span class="line">        ├── LICENSE</span><br><span class="line">        ├── main-page.js    <span class="comment">// 页面js文件</span></span><br><span class="line">        ├── main-page.xml    <span class="comment">// 页面布局文件</span></span><br><span class="line">        ├── main-view-model.js    <span class="comment">// vm对象生成文件</span></span><br><span class="line">        ├── package.json    <span class="comment">// bower dependencies</span></span><br><span class="line">├── node_module     <span class="comment">// node插件忽略</span></span><br><span class="line">├── platforms           <span class="comment">// 转换后的移动端平台代码</span></span><br><span class="line">        ├── android           <span class="comment">// 标准的可移植android项目代码</span></span><br><span class="line">        ├── ios                  <span class="comment">//标准的可移植ios项目代码</span></span><br><span class="line">└──package.json           <span class="comment">//项目信息配置文件</span></span><br></pre></td></tr></table></figure>
<p>从项目的结构可以看出，项目代码使用的mvvm结构，而且它的viewmodel是通过方法操作的。</p>
<ul>
<li>配置移动平台</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ tns platform add ios/android</span><br><span class="line">$ tns run android/ios (真机启动) 或者  tns run android/ios --emulator(启动模拟器)</span><br></pre></td></tr></table></figure>
<p>如果没问题的话就可以看到手机或模拟器上启动了应用程序<br>来自： <a href="http://docs.nativescript.org/hello-world/hello-world-ns-cli.html" target="_blank" rel="external">http://docs.nativescript.org/hello-world/hello-world-ns-cli.html</a></p>
<h3 id="3-_u9879_u76EE_u5206_u6790_u4E0E_u5B9E_u4F8B"><a href="#3-_u9879_u76EE_u5206_u6790_u4E0E_u5B9E_u4F8B" class="headerlink" title="3.项目分析与实例"></a>3.项目分析与实例</h3><p>分析一下页面主要的代码结构</p>
<ul>
<li>app.js，页面的预处理入口，表示启动main-page这个页面</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> application = <span class="built_in">require</span>(<span class="string">"application"</span>);</span><br><span class="line">application.mainModule = <span class="string">"main-page"</span>;</span><br><span class="line">application.cssFile = <span class="string">"./app.css"</span>;</span><br><span class="line">application.start();</span><br></pre></td></tr></table></figure>
<ul>
<li>main-page.js 页面的数据绑定处理，将vm和方法绑定，也可认为是把vm和对象关联绑定</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vmModule = <span class="built_in">require</span>(<span class="string">"./main-view-model"</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pageLoaded</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> page = args.object;</span><br><span class="line">    page.bindingContext = vmModule.mainViewModel;</span><br><span class="line">&#125;</span><br><span class="line">exports.pageLoaded = pageLoaded;</span><br></pre></td></tr></table></figure>
<ul>
<li>main-view-model.js 页面的vm定义模块，申明方法和数据</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> __extends = <span class="keyword">this</span>.__extends || <span class="function"><span class="keyword">function</span> (<span class="params">d, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> p <span class="keyword">in</span> b) <span class="keyword">if</span> (b.hasOwnProperty(p)) d[p] = b[p];</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__</span>(<span class="params"></span>) </span>&#123; <span class="keyword">this</span>.constructor = d; &#125;</span><br><span class="line">    __.prototype = b.prototype;</span><br><span class="line">    d.prototype = <span class="keyword">new</span> __();</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> observable = <span class="built_in">require</span>(<span class="string">"data/observable"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> HelloWorldModel = (<span class="function"><span class="keyword">function</span> (<span class="params">_super</span>) </span>&#123;</span><br><span class="line">    __extends(HelloWorldModel, _super);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">HelloWorldModel</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        _super.call(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">this</span>.counter = <span class="number">42</span>;</span><br><span class="line">        <span class="keyword">this</span>.set(<span class="string">"message"</span>, <span class="keyword">this</span>.counter + <span class="string">" taps left"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    HelloWorldModel.prototype.tapAction = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.counter--;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.counter &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.set(<span class="string">"message"</span>, <span class="string">"Hoorraaay! You unlocked the NativeScript clicker achievement!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.set(<span class="string">"message"</span>, <span class="keyword">this</span>.counter + <span class="string">" taps left"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> HelloWorldModel;</span><br><span class="line">&#125;)(observable.Observable);</span><br><span class="line">exports.HelloWorldModel = HelloWorldModel;</span><br><span class="line">exports.mainViewModel = <span class="keyword">new</span> HelloWorldModel();</span><br></pre></td></tr></table></figure>
<ul>
<li>app.css</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">.title &#123;</span><br><span class="line">    font-size: 30;</span><br><span class="line">    horizontal-align: center;</span><br><span class="line">    margin:20;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">button &#123;</span><br><span class="line">    font-size: 42;</span><br><span class="line">    horizontal-align: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.message &#123;</span><br><span class="line">    font-size: 20;</span><br><span class="line">    color: #284848;</span><br><span class="line">    horizontal-align: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>main-page.xml android上布局的文件，类似vm模板，注意，是xml的，不是html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">Page</span> <span class="attribute">xmlns</span>=<span class="value">"http://www.nativescript.org/tns.xsd"</span> <span class="attribute">loaded</span>=<span class="value">"pageLoaded"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">StackLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">Label</span> <span class="attribute">text</span>=<span class="value">"Tap the button"</span> <span class="attribute">cssClass</span>=<span class="value">"title"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">Button</span> <span class="attribute">text</span>=<span class="value">"TAP"</span> <span class="attribute">tap</span>=<span class="value">"&#123;&#123; tapAction &#125;&#125;"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">Label</span> <span class="attribute">text</span>=<span class="value">"&#123;&#123; message &#125;&#125;"</span> <span class="attribute">cssClass</span>=<span class="value">"message"</span> <span class="attribute">textWrap</span>=<span class="value">"true"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">StackLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">Page</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="4-_u603B_u7ED3_u5206_u6790"><a href="#4-_u603B_u7ED3_u5206_u6790" class="headerlink" title="4.总结分析"></a>4.总结分析</h3><ol>
<li>核心是用JavaScript来写代码，然后预处理成android/ios项目进行打包安装</li>
<li>开发模式基本遵循前端的mvvm思想来实现，只是实现和表现不一样</li>
<li>参考文档完善，整理来说是一个不错的native开发方案</li>
<li>开发使用commonJs的规范，容易理解</li>
<li>但是不足之处也很明显，很难做现有单页面的改造，迭代不方便，功能上线必须像客户端那样发布审核，某些程度上还是需要web页面的支持</li>
</ol>
<p>当然这次只分析了个简单的例子，后面自己搞个复杂的例子来分享下，敬请期待(类似的还有samurai-native和react-native，坐等android支持)~</p>

          
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/06/16/ouvens.github.io/frontend-client/2015-06-16-ionic-app-dev/" itemprop="url">
                  Ionic Hybrid跨终端应用程序开发方案研究
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-06-16T00:00:00+08:00" content="2015-06-16">
              2015-06-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/frontend-client/" itemprop="url" rel="index">
                    <span itemprop="name">frontend-client</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/06/16/ouvens.github.io/frontend-client/2015-06-16-ionic-app-dev/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/06/16/ouvens.github.io/frontend-client/2015-06-16-ionic-app-dev/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ionic是最近一个很流行的Hybird移动开发解决方案，个人兴趣研究了一下，还是不错的<br><a href="https://github.com/driftyco/ionic" target="_blank" rel="external">https://github.com/driftyco/ionic</a></p>
<h3 id="1-_u73AF_u5883_u51C6_u5907"><a href="#1-_u73AF_u5883_u51C6_u5907" class="headerlink" title="1.环境准备"></a>1.环境准备</h3><ul>
<li>安装nodejs</li>
<li>安装cordova和ionic</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$npm install -g cordova ionic</span><br></pre></td></tr></table></figure>
<p>或者下载github上项目代码进行构建(不推荐)</p>
<ul>
<li>安装java JDK<br>  jdk是Java运行开发环境，按android开发必须的开发的环境</li>
</ul>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">JAVA_HOME</span> <span class="constant">D</span><span class="symbol">:/program</span> file/java/jdk_1.<span class="number">7.34</span>/</span><br><span class="line">path <span class="constant">D</span><span class="symbol">:/program</span> file/java/jdk_1.<span class="number">7.34</span>/bin</span><br><span class="line">classpath   <span class="constant">C</span><span class="symbol">:/apache-ant-</span><span class="number">1.8</span>.<span class="number">1</span>/lib</span><br></pre></td></tr></table></figure>
<p>测试方法：java -version</p>
<ul>
<li>安装Apache ant<br>Apache Ant,是一个将软件编译、测试、部署等步骤联系在一起加以自动化的一个工具，大多用于Java环境中的软件开发。由Apache软件基金会所提供。这里用到的的是用于android签名证书等打包(android开发过程中ide使用gradle配置打包，早期都是用的ant打包，这里使用的方法比较原始)<br><a href="http://ant.apache.org/bindownload.cgi" target="_blank" rel="external">http://ant.apache.org/bindownload.cgi</a> 上下载最新版apache-bin(可选择安装型或压缩包型)，然后添加系统环境变量</li>
</ul>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">ANT_HOME</span>    <span class="constant">C</span><span class="symbol">:/</span> apache-ant-<span class="number">1.9</span>.<span class="number">5</span></span><br><span class="line">path        <span class="constant">C</span><span class="symbol">:/</span> apache-ant-<span class="number">1.9</span>.<span class="number">5</span>/bin</span><br><span class="line">classpath   <span class="constant">C</span><span class="symbol">:/apache-ant-</span><span class="number">1.9</span>.<span class="number">5</span>/lib</span><br></pre></td></tr></table></figure>
<p>测试方法：ant -version</p>
<ul>
<li>安装Android sdk<br>下载最新的adk，<a href="http://developer.android.com/sdk/installing/index.html" target="_blank" rel="external">http://developer.android.com/sdk/installing/index.html</a> 下载后解压到某个目录(例如D盘)，然后添加系统环境变量</li>
</ul>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">ANDROID_HOME</span>   <span class="constant">D</span><span class="symbol">:/android-sdk-windows</span></span><br><span class="line">path        <span class="constant">D</span><span class="symbol">:/android</span>\android-sdk-windows\tools</span><br><span class="line">classpath  <span class="constant">D</span><span class="symbol">:/android</span>\android-sdk-windows\tools\lib</span><br></pre></td></tr></table></figure>
<p>测试方法：android<br>必须掌握的两个命令：abd start-server/ adb kill-server，用于启动android debug服务，adb使用与启动模拟器或是通过手机的自动安装调试，并可以看到log信息。这两个命令会经常用到<br>然后 命令行运行一下tns，如果看到以下提示信息，就可以开始第一个开发了。</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># NativeScript</span></span><br><span class="line">┌─────────┬─────────────────────────────</span><br><span class="line">───────────────────────────────────┐</span><br><span class="line">│ Usage   │ Synopsis                                                       │</span><br><span class="line">│ General │ $ tns <span class="variable">&lt;Command&gt;</span> [Command Parameters] [--command <span class="variable">&lt;Options&gt;</span>]     │</span><br><span class="line">│ Alias   │ $ nativescript <span class="variable">&lt;Command&gt;</span> [Command Parameters] [--command       │</span><br><span class="line">│         │ <span class="variable">&lt;Options&gt;</span>]                                                     │</span><br><span class="line">└─────────┴─────────────────────────────</span><br><span class="line">───────────────────────────────────┘</span><br></pre></td></tr></table></figure>
<h3 id="2-_u5F00_u59CB_u5F00_u53D1"><a href="#2-_u5F00_u59CB_u5F00_u53D1" class="headerlink" title="2.开始开发"></a>2.开始开发</h3><ul>
<li>创建项目</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ ionic start projectName tabs</span><br><span class="line">$ cd projectName</span><br><span class="line">├── bower<span class="class">.json</span>     <span class="comment">// bower dependencies</span></span><br><span class="line">├── config<span class="class">.xml</span>        <span class="comment">// cordova configuration，例如标题和入口页面</span></span><br><span class="line">├── gulpfile<span class="class">.js</span>        <span class="comment">// gulp tasks</span></span><br><span class="line">├── hooks              <span class="comment">// custom cordova hooks to execute on specific commands</span></span><br><span class="line">├── resources         <span class="comment">// custom static files such as icon</span></span><br><span class="line">├── ionic<span class="class">.project</span>    <span class="comment">// ionic configuration</span></span><br><span class="line">├── package<span class="class">.json</span>   <span class="comment">// node dependencies</span></span><br><span class="line">├── platforms      <span class="comment">// iOS/Android specific builds will reside here</span></span><br><span class="line">├── plugins         <span class="comment">// where your cordova/ionic plugins will be installed</span></span><br><span class="line">├── scss               <span class="comment">// scss code, which will output to www/css/</span></span><br><span class="line">└── www            <span class="comment">// application - what we need pay attention。JS code and libs, CSS, images, etc.</span></span><br></pre></td></tr></table></figure>
<ul>
<li>配置移动平台</li>
</ul>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ionic platform <span class="keyword">add </span>ios</span><br><span class="line">$ ionic platform <span class="keyword">add </span><span class="keyword">android</span><br><span class="line"></span>$ ionic <span class="keyword">build </span><span class="keyword">android/ios</span><br><span class="line"></span>$ ionic emulator/run <span class="keyword">android/ios </span>(emulator将在模拟器上启动，run将在真实手机上启动)</span><br></pre></td></tr></table></figure>
<p>如果能够正常启动，就可以任性的开发了。</p>
<h3 id="3-_u9879_u76EE_u4EE3_u7801_u7ED3_u6784_u5206_u6790"><a href="#3-_u9879_u76EE_u4EE3_u7801_u7ED3_u6784_u5206_u6790" class="headerlink" title="3.项目代码结构分析"></a>3.项目代码结构分析</h3><p>对于前端开发来说，只要关注www/下的项目代码就可以了，打包编译后www将会到android项目的asset目录下面。而客户端的主页面是通过一个入口html来开始运行的，如下：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ionicframework.demo862117;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.<span class="type">Bundle</span>;</span><br><span class="line"><span class="keyword">import</span> org.apache.cordova.*;</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">CordovaActivity</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    public void onCreate(<span class="type">Bundle</span> savedInstanceState)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="keyword">super</span>.init();</span><br><span class="line">        <span class="comment">// Set by &lt;content src="index.html" /&gt; in config.xml</span></span><br><span class="line">        loadUrl(launchUrl);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里主页面打包后会生成带上主要的android/ios外壳，界面产生的所有内容由H5实现。</p>
<h3 id="4-angular_u4E0E_u7EC4_u4EF6_u5316"><a href="#4-angular_u4E0E_u7EC4_u4EF6_u5316" class="headerlink" title="4.angular与组件化"></a>4.angular与组件化</h3><p>ionic使用了angular作为基础开发库，并用组件化的方案来管理自己的一套前端库，主要用到angular，angular-ui，iconfont，svg等前端技术知识，这里不一一展开了。<br><a href="http://www.ionicframework.com/docs/components/" target="_blank" rel="external">http://www.ionicframework.com/docs/components/</a> ，当然这里有了一套完整的前端开发框架很文档。即如果我们用它来开发应用的话，是需要用它的框架来写代码就可以了。</p>
<h3 id="5-_u603B_u7ED3_u5206_u6790"><a href="#5-_u603B_u7ED3_u5206_u6790" class="headerlink" title="5.总结分析"></a>5.总结分析</h3><h4 id="u4F18_u52BF"><a href="#u4F18_u52BF" class="headerlink" title="优势"></a>优势</h4><ol>
<li>大量可参考的组件和文档，使得开发入门成本比较低</li>
<li>兼容angular(当然自己也可以用其他的，只是默认创建项目时引入了angular)</li>
<li>整理来说，ionic的方案仍然集中在hybrid开发的集成化，对于快速开发内嵌页面来说是很好的选择</li>
<li>前端人员除了搭环境，不需要了解过多客户端的知识，就可以开发hybrid跨终端的app了</li>
</ol>
<h4 id="u53EF_u80FD_u5B58_u5728_u7684_u4E0D_u8DB3_uFF1A"><a href="#u53EF_u80FD_u5B58_u5728_u7684_u4E0D_u8DB3_uFF1A" class="headerlink" title="可能存在的不足："></a>可能存在的不足：</h4><ol>
<li>直接将页面打包发布会使得迭代不好解决，如果使用离线包机制可以解决这一问题，但是客户端的定制化仍然我们对预- - 处理后的代码进行较大的二次修改</li>
<li>依然停留在webview开发阶段，不能突破webview解析dom的性能问题</li>
<li>目前没有自动化调试，需借助外部工具来做</li>
</ol>

          
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/05/24/ouvens.github.io/frontend-javascript/2015-05-24-polymer-vm/" itemprop="url">
                  polymer组件化与vm特性
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-05-24T00:00:00+08:00" content="2015-05-24">
              2015-05-24
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/frontend-javascript/" itemprop="url" rel="index">
                    <span itemprop="name">frontend-javascript</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/05/24/ouvens.github.io/frontend-javascript/2015-05-24-polymer-vm/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/05/24/ouvens.github.io/frontend-javascript/2015-05-24-polymer-vm/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="u4E00_u3001Polymer"><a href="#u4E00_u3001Polymer" class="headerlink" title="一、Polymer"></a>一、Polymer</h4><p>Polymer是Google在2013年的Google I/O大会上提出了一个新的UI框架。Polymer的实现使用了WebComponent标准，并且Polymer可保证针对包含各种平台的Web Component规范本地实现的浏览器、库和组件的使用效果完全相同。</p>
<h4 id="1-1_Polymer_u6846_u67B6_uFF1A"><a href="#1-1_Polymer_u6846_u67B6_uFF1A" class="headerlink" title="1.1 Polymer框架："></a>1.1 Polymer框架：</h4><p>Polymer框架可以分为三个层次：</p>
<ul>
<li>基础层(platform.js)：是基本构建块。大多数情况下，基础层都是本地浏览器的API。</li>
<li>核心层(polymer.js)：实现基础层的辅助器。</li>
<li>元素层：建立在核心层之上的UI组件或非UI组件。</li>
</ul>
<h4 id="1-2__u57FA_u7840_u5C42"><a href="#1-2__u57FA_u7840_u5C42" class="headerlink" title="1.2 基础层"></a>1.2 基础层</h4><p>基础层包括以下技术：</p>
<ul>
<li>DOM Mutation Oberservers和Object.observe()：用于观察DOM元素的变更，是纯JavaScript对象。</li>
<li>指针事件：处理鼠标和触摸操作，支持所有的平台。</li>
<li>阴影DOM：封装元素内的结构和样式，适合自定义元素。</li>
<li>自定义元素：可以自定义HTML5的元素。自定义元素的名字必须包含一个破折号，这是一种简单的命名空间标识，以区别于标准元素。</li>
<li>HTML导入：包自定义元素。这些包可能包含HTML、CSS和JavaScript。</li>
<li>模型驱动的视图(MDV)：把数据直接绑定到HTML。</li>
<li>Web动画：一套统一的Web动画API。<br>阴影DOM、自定义元素和HTML元素Web Components，是网络组件模型。Web Components是Polymer框架的最重要的基础。<br>platform.js目前浏览器还没有提供，它仅有31KB大小。</li>
</ul>
<h4 id="1-3__u6838_u5FC3_u5C42_u548C_u5143_u7D20_u5C42_uFF0C_u5373_u7EC4_u4EF6UI_u548C_u7EC4_u4EF6_u903B_u8F91"><a href="#1-3__u6838_u5FC3_u5C42_u548C_u5143_u7D20_u5C42_uFF0C_u5373_u7EC4_u4EF6UI_u548C_u7EC4_u4EF6_u903B_u8F91" class="headerlink" title="1.3 核心层和元素层，即组件UI和组件逻辑"></a>1.3 核心层和元素层，即组件UI和组件逻辑</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">polymer-panels</span> <span class="attribute">on-select</span>=<span class="value">"panelSelectHandler"</span> <span class="attribute">selected</span>=<span class="value">"&#123;&#123;selectedPanelIndex&#125;&#125;"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="title">polymer-panels</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>其架构是面向组件的，它由HTML5元素组成，元素甚至可以用户界面，比如动画是元素，它没有UI，而是代替点。同时响应式设计内建了许多Widget，这意味着它们能自适应多种给定的平台，如手机、平板、桌面等。</p>
<h3 id="u4E8C_u3001Polymer_u7684_u4E00_u4E2A_u4F8B_u5B50"><a href="#u4E8C_u3001Polymer_u7684_u4E00_u4E2A_u4F8B_u5B50" class="headerlink" title="二、Polymer的一个例子"></a>二、Polymer的一个例子</h3><h5 id="1-__u5148_u770B_u4E0B_u9762polymer_u7684_u4E00_u4E2A_u4F8B_u5B50_u4EE3_u7801"><a href="#1-__u5148_u770B_u4E0B_u9762polymer_u7684_u4E00_u4E2A_u4F8B_u5B50_u4EE3_u7801" class="headerlink" title="1. 先看下面polymer的一个例子代码"></a>1. 先看下面polymer的一个例子代码</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">script</span>  <span class="attribute">src</span>=<span class="value">"../components/platform/platform.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 下面用到的几个组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"import"</span> <span class="attribute">href</span>=<span class="value">"../components/core-header-panel/core-header-panel.html"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"import"</span> <span class="attribute">href</span>=<span class="value">"../components/core-toolbar/core-toolbar.html"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"import"</span> <span class="attribute">href</span>=<span class="value">"../components/paper-tabs/paper-tabs.html"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="2-_Polymer__u4F7F_u7528_HTML_imports_u6280_u672F_u6765_u52A0_u8F7D_u7EC4_u4EF6_u3002"><a href="#2-_Polymer__u4F7F_u7528_HTML_imports_u6280_u672F_u6765_u52A0_u8F7D_u7EC4_u4EF6_u3002" class="headerlink" title="2. Polymer 使用 HTML imports技术来加载组件。"></a>2. Polymer 使用 HTML imports技术来加载组件。</h5><p>HTML imports提供了依赖管理,确保自定义元素及其所有的依赖项都在使用之前被加载进来。</p>
<h5 id="3-__u8981_u589E_u52A0_u4E00_u4E2A_u5DE5_u5177_u6761_28toolbar_29_2C__u53EF_u4EE5_u5728_body__u6807_u7B7E_u5185_u6DFB_u52A0_u4E0B_u9762_u7684_u4EE3_u7801_3A"><a href="#3-__u8981_u589E_u52A0_u4E00_u4E2A_u5DE5_u5177_u6761_28toolbar_29_2C__u53EF_u4EE5_u5728_body__u6807_u7B7E_u5185_u6DFB_u52A0_u4E0B_u9762_u7684_u4EE3_u7801_3A" class="headerlink" title="3. 要增加一个工具条(toolbar), 可以在 body 标签内添加下面的代码:"></a>3. 要增加一个工具条(toolbar), 可以在 body 标签内添加下面的代码:</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">core-header-panel</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="title">core-toolbar</span>&gt;</span> </span><br><span class="line">      <span class="comment">&lt;!-- 添加一些选项卡,以paper-开头的是Material design风格的标签,具有很炫酷的效果 --&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="title">paper-tabs</span> <span class="attribute">valueattr</span>=<span class="value">"name"</span> <span class="attribute">selected</span>=<span class="value">"all"</span> <span class="attribute">self-end</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="title">paper-tab</span> <span class="attribute">name</span>=<span class="value">"all"</span>&gt;</span>所有<span class="tag">&lt;/<span class="title">paper-tab</span>&gt;</span> </span><br><span class="line">              <span class="tag">&lt;<span class="title">paper-tab</span> <span class="attribute">name</span>=<span class="value">"favorites"</span>&gt;</span>收藏<span class="tag">&lt;/<span class="title">paper-tab</span>&gt;</span> </span><br><span class="line">              <span class="tag">&lt;/<span class="title">paper-tabs</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;/<span class="title">core-toolbar</span>&gt;</span> </span><br><span class="line">      <span class="comment">&lt;!-- 主要的页面内容将会放在这里 --&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;/<span class="title">core-header-panel</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">core-header-panel</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>元素是一个简单的容器,例如包含一个header和一些内容。默认情况下, header 保持在屏幕的顶部,但也可以设置为随内容滚动。core-toolbar元素作为容器,可以存放 选项卡(tab)的,菜单按钮以及其他控件。<br>给迪例子较为简单，目前由于以下兼容性Polymer用的还不是很多，但是通过Polymer组件化的思想，也可以给我们一些组件未来化的方向。</p>
<h3 id="u4E09_u3001Polymer_u7684vm_u7279_u6027"><a href="#u4E09_u3001Polymer_u7684vm_u7279_u6027" class="headerlink" title="三、Polymer的vm特性"></a>三、Polymer的vm特性</h3><h4 id="3-1_u3001_u6570_u636E_u7684_u53CC_u5411_u7ED1_u5B9A"><a href="#3-1_u3001_u6570_u636E_u7684_u53CC_u5411_u7ED1_u5B9A" class="headerlink" title="3.1、数据的双向绑定"></a>3.1、数据的双向绑定</h4><p>Polymer 支持双向的数据绑定。数据绑定通过扩展 HTML 和 DOM API 来支持应用的 UI (DOM) 及其底层数据 (数据模型) 之前的有效分离。更新数据模型会反映在 DOM 上，而 DOM 上的用户输入会立即赋值到数据模型上。<br>对于 Polymer elements 来说，数据模型始终就是 element 本身。比如想想这个简单的 element：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">polymer-element</span> <span class="attribute">name</span>=<span class="value">"name-tag"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">template</span>&gt;</span></span><br><span class="line">    这是一个 <span class="tag">&lt;<span class="title">b</span>&gt;</span>&#123;&#123;owner&#125;&#125;<span class="tag">&lt;/<span class="title">b</span>&gt;</span> 的 name-tag element。</span><br><span class="line">  <span class="tag">&lt;/<span class="title">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="actionscript"></span><br><span class="line">    Polymer(<span class="string">'name-tag'</span>, &#123;</span><br><span class="line">      <span class="comment">// initialize the element's model</span></span><br><span class="line">      ready: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.owner = <span class="string">'Rafael'</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  </span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">polymer-element</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里owner属性里的name-tag就相当于mvvm中vuejs的derectives，angular中的controller，如果你更新了owner属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">'name-tag'</span>).owner = <span class="string">'shabi'</span>;</span><br></pre></td></tr></table></figure>
<p>你就会看到： 这是一个 shabi 的 name-tag element。</p>
<h4 id="3-2_template_u60F0_u6027_u5143_u7D20"><a href="#3-2_template_u60F0_u6027_u5143_u7D20" class="headerlink" title="3.2 template惰性元素"></a>3.2 template惰性元素</h4><p>这点实现原理就比较简单，使用了template包含一段html片段，那这段html片段开始是隐藏的，将会在渲染完成后再插入到页面中，个人分析，这样做的一个主要原因就是防止mvvm中html未初始化时的模板代码到正式生成html页面过程中闪的过程，使用angular或avalon的话一般会遇到这样的问题</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">polymer-element</span> <span class="attribute">name</span>=<span class="value">"greeting-tag"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 最外面的 template 定义了 element 的 shadow DOM --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">template</span> <span class="attribute">repeat</span>=<span class="value">"&#123;&#123;s in salutations&#125;&#125;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">li</span>&gt;</span>&#123;&#123;s.what&#125;&#125;: <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">value</span>=<span class="value">"&#123;&#123;s.who&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="actionscript"></span><br><span class="line">    Polymer(<span class="string">'greeting-tag'</span>, &#123;</span><br><span class="line">      ready: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 植入 element 的数据模型 (数组 salutations)</span></span><br><span class="line">        <span class="keyword">this</span>.salutations = [</span><br><span class="line">          &#123;what: <span class="string">'Hello'</span>, who: <span class="string">'World'</span>&#125;,</span><br><span class="line">          &#123;what: <span class="string">'GoodBye'</span>, who: <span class="string">'DOM APIs'</span>&#125;,</span><br><span class="line">          &#123;what: <span class="string">'Hello'</span>, who: <span class="string">'Declarative'</span>&#125;,</span><br><span class="line">          &#123;what: <span class="string">'GoodBye'</span>, who: <span class="string">'Imperative'</span>&#125;</span><br><span class="line">        ];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  </span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">polymer-element</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>例如这里template里面的内容开始是隐藏的，将会在mv扫面节点完成后插入到dom树里，避免页面闪的发生。其中模板里面的变量使用的类mustache语法，和Avalon极其类似。</p>
<h4 id="3-3__u6570_u636E_u7ED1_u5B9A_u4E0E_u4E8B_u4EF6_u5904_u7406"><a href="#3-3__u6570_u636E_u7ED1_u5B9A_u4E0E_u4E8B_u4EF6_u5904_u7406" class="headerlink" title="3.3 数据绑定与事件处理"></a>3.3 数据绑定与事件处理</h4><p>这部分下次来讲，这次主要讲polymer，这部分也可以参考我之前qvm的看下mvvm中事件绑定和代理的实现。<a href="https://github.com/ouvens/qvm" target="_blank" rel="external">qvm gitHub地址</a></p>
<h3 id="u56DB_u3001_u524D_u7AEF_u7EC4_u4EF6_u5316_u7684_u53D1_u5C55_u65B9_u5411"><a href="#u56DB_u3001_u524D_u7AEF_u7EC4_u4EF6_u5316_u7684_u53D1_u5C55_u65B9_u5411" class="headerlink" title="四、前端组件化的发展方向"></a>四、前端组件化的发展方向</h3><p>当然polymer只是前端组件化未来的一种方向，这种思想也即将带来一系列前端新的技术方向出现，例如可能</p>
<p>####1. Web Component规范化定义<br>基于标准化的组件定义方式，我们便可以像W3C等标准组织一样来定义组件标准，成为html规范的一部分，不用依赖其它组件，成为未来web开发基础规范来实现，支持vm监听功能等。例如polymer这种方案的发展就借鉴了webcomponent和mvvm的融合思想。</p>
<h4 id="2-_react_u751F_u6001"><a href="#2-_react_u751F_u6001" class="headerlink" title="2. react生态"></a>2. react生态</h4><p>react的组件化生态思想和webComponent也及其相似，当然react做了更多的事情，除了web Component，react想做的其实可以称为platform component。</p>
<h4 id="3-_angular_2-0__u548C_EmberJS_u7B49_u73B0_u6709_u6210_u719F_u65B9_u6848_u7684_u6539_u8FDB"><a href="#3-_angular_2-0__u548C_EmberJS_u7B49_u73B0_u6709_u6210_u719F_u65B9_u6848_u7684_u6539_u8FDB" class="headerlink" title="3. angular 2.0 和 EmberJS等现有成熟方案的改进"></a>3. angular 2.0 和 EmberJS等现有成熟方案的改进</h4><p>angular2.0已明确提出将支持Node绑定、模板集成、元素自定义和支持网络组件的无缝集成；ember的发展情况依然，今后也不排除jQuery等框架的进化重生，以全新的面目出现。</p>
<h4 id="4-__u5F00_u53D1_u8005_u7684_u5176_u5B83_u5C0F_u4F17_u89E3_u51B3_u65B9_u6848"><a href="#4-__u5F00_u53D1_u8005_u7684_u5176_u5B83_u5C0F_u4F17_u89E3_u51B3_u65B9_u6848" class="headerlink" title="4. 开发者的其它小众解决方案"></a>4. 开发者的其它小众解决方案</h4><p>在企业中，针对企业特殊性的业务，企业前端开发者也可以根据webComponent的思想自己实现更加灵活可用的组件拼装解决方案。相比之下，这个方向的探索研究甚至会更加受欢迎，因为只有开发者才关注关注自己的组件怎么管理。例如目前qiqi项目所用的方案就比较符合这个方向。</p>

          
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/04/01/ouvens.github.io/frontend-build/2015-04-01-webpack-tool/" itemprop="url">
                  webpack--更优秀的打包管理工具
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-04-01T00:00:00+08:00" content="2015-04-01">
              2015-04-01
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/frontend-build/" itemprop="url" rel="index">
                    <span itemprop="name">frontend-build</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/04/01/ouvens.github.io/frontend-build/2015-04-01-webpack-tool/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/04/01/ouvens.github.io/frontend-build/2015-04-01-webpack-tool/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="webpack_u662F_u4EC0_u4E48"><a href="#webpack_u662F_u4EC0_u4E48" class="headerlink" title="webpack是什么"></a>webpack是什么</h2><p>德国开发者Tobias Koppers开发的模块加载器，可用于处理依赖分析和进行打包。</p>
<h2 id="commonJS_u4E0EAMD_u652F_u6301"><a href="#commonJS_u4E0EAMD_u652F_u6301" class="headerlink" title="commonJS与AMD支持"></a>commonJS与AMD支持</h2><p>Webpack 对 CommonJS 的 AMD 的语法做了兼容，不过实际上, 引用模块的规则是依据 CommonJS 来的，即如果使用AMD语法，还是根据commonJS语法进行模块查找的。<br>当然我们之前可也以这么写来兼容AMD和commonJS，但是用了webpack语法上就可以任意去写了：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">window, factory</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (typeod exports === <span class="string">'object'</span>) &#123;</span><br><span class="line">        <span class="built_in">module</span>.exports = factory();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.amd) &#123;</span><br><span class="line">        define([],factory);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">window</span>.eventUtil = factory();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//module ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="u5982_u4F55_u547D_u4EE4_u8C03_u7528webpack"><a href="#u5982_u4F55_u547D_u4EE4_u8C03_u7528webpack" class="headerlink" title="如何命令调用webpack"></a>如何命令调用webpack</h2><p>切换到含有webpack.config.js的目录，执行以下命令：<br>webpack        开发调试环境构建<br>webpack -p    产品发布环境构建，包含压缩，minify最小化<br>webpack        –watch 开发调试环境并开启文件watch(fast!)<br>webpack -d    包含source map打包</p>
<h2 id="u57FA_u672C_u914D_u7F6E_u4F7F_u7528"><a href="#u57FA_u672C_u914D_u7F6E_u4F7F_u7528" class="headerlink" title="基本配置使用"></a>基本配置使用</h2><p>安装webpack模块之后, 可是使用 webpack 这个命令行工具进行文件打包等处理，可以使用参数, 也可以配置 webpack.config.js 文件直接运行 webpack 调用。或者使用gulp或grunt的webpack插件，结合其他的插件一起使用。例如使用webpack打包一个文件的配置就可以这么写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">'./main.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'bundle.js'</span>       </span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">当然也可以这样，webpack支持了coffee和jsx，喜欢玩react的同学可以试下。</span><br><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">'./main.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'bundle.js'</span>       </span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    loaders: [</span><br><span class="line">      &#123; test: <span class="regexp">/\.coffee$/</span>, loader: <span class="string">'coffee-loader'</span> &#125;,</span><br><span class="line">      &#123; test: <span class="regexp">/\.js$/</span>, loader: <span class="string">'jsx-loader?harmony'</span> &#125; <span class="comment">// loaders can take parameters as a querystring</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="u6587_u4EF6_u67E5_u627E_u4F9D_u8D56"><a href="#u6587_u4EF6_u67E5_u627E_u4F9D_u8D56" class="headerlink" title="文件查找依赖"></a>文件查找依赖</h2><p>Webpack 是在本地按目录对依赖进行查找的，构造一个例子，可以用 –display-error-details 查看查找过程，例如一下例子配置当中 resolve.extensions 用于指明程序自动补全识别哪些后缀，需要注意的是， extensions 一般需要包含空字符串的情况，对应不需要后缀的情况。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">'./a.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'b.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    extensions: [<span class="string">''</span>, <span class="string">'.coffee'</span>, <span class="string">'.js'</span>, <span class="string">'.coffee'</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="u56FE_u7247_u53CAcss_u7684_u5F15_u7528"><a href="#u56FE_u7247_u53CAcss_u7684_u5F15_u7528" class="headerlink" title="图片及css的引用"></a>图片及css的引用</h2><p>css跟 less，还有图片，被直接引用了。实际上 CSS 被转化为 <style> 标签，而图片可能被转化成 base64 格式的dataUrl，但是要主要在 webpack.config.js 文件写好对应的 loader：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'./bootstrap.css'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'./myapp.less'</span>);</span><br><span class="line"><span class="keyword">var</span> img = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>);</span><br><span class="line">img.src = <span class="built_in">require</span>(<span class="string">'./glyph.png'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">'./main.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: <span class="string">'./build'</span>, <span class="comment">// This is where images AND js will go</span></span><br><span class="line">    publicPath: <span class="string">'http://mycdn.com/'</span>, <span class="comment">// This is used to generate URLs to e.g. images</span></span><br><span class="line">    filename: <span class="string">'bundle.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    loaders: [</span><br><span class="line">      &#123; test: <span class="regexp">/\.less$/</span>, loader: <span class="string">'style-loader!css-loader!less-loader'</span> &#125;, <span class="comment">// use ! to chain loaders</span></span><br><span class="line">      &#123; test: <span class="regexp">/\.css$/</span>, loader: <span class="string">'style-loader!css-loader'</span> &#125;,</span><br><span class="line">      &#123;test: <span class="regexp">/\.(png|jpg)$/</span>, loader: <span class="string">'url-loader?limit=8192'</span>&#125; <span class="comment">// inline base64 URLs for &lt;=8k images, direct URLs for the rest</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这样我们就可以做很多事情了，尤其是移动端，为了避免过多的css和图片请求，可以通过及其简单的配置就可以在打包时系统帮我们自动做到inline css和图片。</p>
<h2 id="url-loader_u662F_u4EC0_u4E48"><a href="#url-loader_u662F_u4EC0_u4E48" class="headerlink" title="url-loader是什么"></a>url-loader是什么</h2><p>url-loader是对文件加载器file-loader的封装，并且在file-loader完成后进行一些更多的处理</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.demo</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">background-image</span>:<span class="value"> <span class="function">url</span>(<span class="string">'a.png'</span>)</span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>例如以上图片的引用，通过配置可以把a.png抓出来，并按照文件大小，转化为base64或作为单独文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  loaders: [</span><br><span class="line">    &#123;test: <span class="regexp">/\.(png|jpg)$/</span>, loader: <span class="string">'url-loader?limit=8192'</span>&#125; <span class="comment">// inline base64 URLs for &lt;=8k images, direct URLs for the rest</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="u4F18_u5316_u6253_u6210_u591A_u4E2A_u6280_u672F_u6587_u4EF6_u5305"><a href="#u4F18_u5316_u6253_u6210_u591A_u4E2A_u6280_u672F_u6587_u4EF6_u5305" class="headerlink" title="优化打成多个技术文件包"></a>优化打成多个技术文件包</h2><p>有时考虑类库代码的缓存，同时也需要打多个文件包，这样也很简单，比如下边的配置,，首先 entry 有多个属性, 对应多个 JavaScript 包，然后 commonsPlugin 可以用于分析模块的共用代码，单独打一个包出来:<br><a href="https://github.com/petehunt/webpack-howto#8-optimizing-common-code">https://github.com/petehunt/webpack-howto#8-optimizing-common-code</a><br><a href="https://github.com/webpack/docs/wiki/optimization#multi-page-app">https://github.com/webpack/docs/wiki/optimization#multi-page-app</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="keyword">var</span> commonsPlugin = <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(<span class="string">'common.js'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    Profile: <span class="string">'./profile.js'</span>,</span><br><span class="line">    Feed: <span class="string">'./feed.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: <span class="string">'build'</span>,</span><br><span class="line">    filename: <span class="string">'[name].js'</span> <span class="comment">// Template based on keys in entry above</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [commonsPlugin]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>如果入口传入的是一个数组，则会把多个文件一起打包，最后导出最后一个</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        page1: <span class="string">"./page1"</span>,</span><br><span class="line">        page2: [<span class="string">"./entry1"</span>, <span class="string">"./entry2"</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        <span class="comment">// Make sure to use [name] or [id] in output.filename</span></span><br><span class="line">        <span class="comment">//  when using multiple entry points</span></span><br><span class="line">        filename: <span class="string">"[name].bundle.js"</span>,</span><br><span class="line">        chunkFilename: <span class="string">"[id].bundle.js"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里profile和feed都引了common.js，但是webpack不会打commonjs都打到两个文件包里面去，而是自动增加一个<script src="common.js"></script>到引用的文件前面。</p>
<h2 id="js_u5F02_u6B65_u52A0_u8F7D"><a href="#js_u5F02_u6B65_u52A0_u8F7D" class="headerlink" title="js异步加载"></a>js异步加载</h2><p>对于一个打包工具，我们很自然去关心异步的问题。commonJS是同步的，但是webpack提供了一个处理异步的方法，这样在页面上处理路由等就很有用，例如以下配置可以在条件分支上异步加载js模块。当打包的模块被引入时webpack会假设被异步打包的文件都在根路径上，并最后通过插入到script标签中来实现异步加载。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.location.pathname === <span class="string">'/feed'</span>) &#123;</span><br><span class="line">  showLoadingState();</span><br><span class="line">  <span class="built_in">require</span>.ensure([], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// this syntax is weird but it works</span></span><br><span class="line">    hideLoadingState();</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">'./feed'</span>).show(); <span class="comment">// when this function is called, the module is guaranteed to be synchronously available.</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">window</span>.location.pathname === <span class="string">'/profile'</span>) &#123;</span><br><span class="line">  showLoadingState();</span><br><span class="line">  <span class="built_in">require</span>.ensure([], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    hideLoadingState();</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">'./profile'</span>).show();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="u5BF9_u6587_u4EF6_u505Arevision"><a href="#u5BF9_u6587_u4EF6_u505Arevision" class="headerlink" title="对文件做revision"></a>对文件做revision</h2><p>使用webpack可对文件生成带hash的文件名<br>output: { chunkFilename: “[chunkhash].bundle.js” }<br>引入可插件就可以这样写</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.plugin(<span class="string">"done"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">stats</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">require</span>(<span class="string">"fs"</span>).writeFileSync(</span><br><span class="line">        path.join(__dirname, <span class="string">"..."</span>, <span class="string">"stats.json"</span>),</span><br><span class="line">        <span class="built_in">JSON</span>.stringify(stats.toJson()));</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="u4E0A_u7EBF_u538B_u7F29_uFF1A"><a href="#u4E0A_u7EBF_u538B_u7F29_uFF1A" class="headerlink" title="上线压缩："></a>上线压缩：</h2><p>压缩js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">   <span class="keyword">new</span> webpack.optimize.MinChunkSizePlugin(minSize)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>优化react<br>new webpack.DefinePlugin({<br>  “process.env”: {<br>    NODE_ENV: JSON.stringify(“production”)<br>  }<br>})<br>cdn替换<br>替换 CDN 这个工作, webpack 也内置了, 设置 output.publicPath 即可。<a href="http://webpack.github.io/docs/configuration.html#output-publicpath">http://webpack.github.io/docs/configuration.html#output-publicpath</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Example</span></span><br><span class="line">output: &#123;</span><br><span class="line">    path: <span class="string">"/home/proj/public/assets"</span>,</span><br><span class="line">    publicPath: <span class="string">"/assets/"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Example CDN</span></span><br><span class="line">output: &#123;</span><br><span class="line">    path: <span class="string">"/home/proj/cdn/assets/[hash]"</span>,</span><br><span class="line">    publicPath: <span class="string">"http://cdn.example.com/assets/[hash]/"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对比下fis<br>相对于fis更加轻量级，webpack更加灵活</p>
<p>最后给几个官方文档的地址：<br><a href="http://webpack.github.io/">http://webpack.github.io/</a><br><a href="https://github.com/webpack">https://github.com/webpack</a><br><a href="http://webpack.github.io/docs/">http://webpack.github.io/docs/</a><br><a href="https://github.com/petehunt/webpack-howto">https://github.com/petehunt/webpack-howto</a></p>
</style></p>
          
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/03/16/ouvens.github.io/Frontend-weboptimize/2015-03-16-front-end-performance-test/" itemprop="url">
                  前端性能测试
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-03-16T00:00:00+08:00" content="2015-03-16">
              2015-03-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/frontend-weboptimize/" itemprop="url" rel="index">
                    <span itemprop="name">frontend-weboptimize</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/03/16/ouvens.github.io/Frontend-weboptimize/2015-03-16-front-end-performance-test/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/03/16/ouvens.github.io/Frontend-weboptimize/2015-03-16-front-end-performance-test/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="u4E00_u3001performance_timing_API"><a href="#u4E00_u3001performance_timing_API" class="headerlink" title="一、performance timing API"></a>一、performance timing API</h3><p>performance timing API支持ie9以上浏览器，页面请求的整个过程和performance API记录的点</p>
<p><img src="http://7tszky.com1.z0.glb.clouddn.com/FqJwnMWrQQ50yyfCN7VyLHBBtuS7" alt=""></p>
<p><a href="http://javascript.ruanyifeng.com/bom/performance.html" target="_blank" rel="external">http://javascript.ruanyifeng.com/bom/performance.html</a></p>
<p>根据这个过程 performance.timing会记录页面请求的各个点的timestamp，经过简单输出，就可以得到页面请求每个过程所消耗的时间了。<br>也可以使用现有的实现，原理和以上代码相同：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">performanceTest</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> timing = performance.timing,</span><br><span class="line">        readyStart = timing.fetchStart - timing.navigationStart,</span><br><span class="line">        redirectTime = timing.redirectEnd  - timing.redirectStart,</span><br><span class="line">        appcacheTime = timing.domainLookupStart  - timing.fetchStart,</span><br><span class="line">        unloadEventTime = timing.unloadEventEnd - timing.unloadEventStart,</span><br><span class="line">        lookupDomainTime = timing.domainLookupEnd - timing.domainLookupStart,</span><br><span class="line">        connectTime = timing.connectEnd - timing.connectStart,</span><br><span class="line">        requestTime = timing.responseEnd - timing.requestStart,</span><br><span class="line">        initDomTreeTime = timing.domInteractive - timing.responseEnd,</span><br><span class="line">        domReadyTime = timing.domComplete - timing.domInteractive,</span><br><span class="line">        loadEventTime = timing.loadEventEnd - timing.loadEventStart,</span><br><span class="line">        loadTime = timing.loadEventEnd - timing.navigationStart;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'准备新页面时间耗时: '</span> + readyStart);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'redirect 重定向耗时: '</span> + redirectTime);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Appcache 耗时: '</span> + appcacheTime);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'unload 前文档耗时: '</span> + unloadEventTime);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'DNS 查询耗时: '</span> + lookupDomainTime);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'TCP连接耗时: '</span> + connectTime);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'request请求耗时: '</span> + requestTime);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'请求完毕至DOM加载: '</span> + initDomTreeTime);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'解释dom树耗时: '</span> + domReadyTime);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'load事件耗时: '</span> + loadEventTime);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'加载时间耗时: '</span> + loadTime);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>总结分析：<br>1，对我们有用的，解释dom树耗时、load事件耗时、整个事件耗时作为整体性能参考<br>2，优化从dom树解析和事件绑定两个方面进行考虑</p>
<p>一些其他的能力：<br>performance.memory<br>performance.navigator<br>performance.now()   performance.now方法返回当前网页自从performance.timing.navigationStart到当前时间之间的微秒数（毫秒的千分之一）。也就是说，它的精度可以达到100万分之一秒<br>performance.mark()  mark方法用于为相应的视点做标记<br>performance.getEntries()  浏览器获取网页时，会对网页中每一个对象（脚本文件、样式表、图片文件等等）发出一个HTTP请求。performance.getEntries方法以数组形式，返回这些请求的时间统计信息，有多少个请求，返回数组就会有多少个成员。<br>performance.navigation performance还可以提供一些用户行为信息，主要都存放在performance.navigation对象上面。</p>
<p>performance.navigation.redirectCount 该属性表示当前网页经过了多少次重定向跳转。</p>
<p>应用：performanceTracer 和 perfmap<br>perfmap: 匹配页面上说有的/url((“?http.*”?))/ig 请求，使用performance.getEntries获取每个请求的timing</p>
<h3 id="u4E8C_u3001profile_u5DE5_u5177"><a href="#u4E8C_u3001profile_u5DE5_u5177" class="headerlink" title="二、profile工具"></a>二、profile工具</h3><p>html5 performance API描述了加载到渲染各个阶段的执行情况，但是无法知道页面中js执行的各个动作所需要的时间。<br>    profile是chrome和火狐的标准浏览器带有的一种测试页面运行时间及时间内动作的性能分析api，以chrome为例，结合浏览器的profile功能，我们可以做以下几个事情：<br>    1、分析页面js执行的每个过程时间和分析出页面交互过程最耗时的操作<br>    2、分析页面执行过程中js对象或dom对象堆栈内存的使用情况<br>    3、记录js对象消耗的内存情况<br>    4、检测一段时间内CPU占用情况</p>
<p>例如使用console.profile()和console.profileEnd()，就可以分析中间一段代码的执行情况：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">console</span>.profile();</span><br><span class="line"><span class="comment">//TO DOS</span></span><br><span class="line"><span class="built_in">console</span>.profileEnd();</span><br><span class="line"></span><br><span class="line"><span class="string">``</span><span class="string">`  </span><br><span class="line"></span><br><span class="line">### 三、打点测试</span><br><span class="line"></span><br><span class="line">使用profile可以一定程度上帮助我们分析页面的性能情况，但是缺点是不够灵活，例如我们希望检测每段代码执行的具体情况，我们不可能写很多的console.profile()和console.profileEnd()，为了更加灵活的控制页面js的执行情况，这是需要自己打点计时来计算每部分代码的运行情况。</span><br><span class="line">        原理也相当简单，记录js代码开始执行的timestamp，后面在需要记录的地方打点记录timestamp，最后通过差值来计算每段js的运行时间。然后对于重复操作，我们可以用下面的例子</span><br><span class="line"></span><br><span class="line">`</span><span class="string">``</span>javascript</span><br><span class="line"><span class="keyword">var</span> T = []; <span class="function"><span class="keyword">function</span> <span class="title">PT</span>(<span class="params">tag</span>)</span>&#123; T.push(&#123;<span class="string">"tag"</span>:tag,<span class="string">"time"</span>:+<span class="keyword">new</span> <span class="built_in">Date</span>&#125;); &#125;</span><br><span class="line">PT(<span class="string">"loading"</span>);</span><br><span class="line"></span><br><span class="line">T.push(&#123;<span class="string">"tag"</span>:<span class="string">"load"</span>,<span class="string">"time"</span>:+<span class="keyword">new</span> <span class="built_in">Date</span>()&#125;);</span><br><span class="line"><span class="comment">//TO DOS</span></span><br><span class="line">T.push(&#123;<span class="string">"tag"</span>:<span class="string">"load"</span>,<span class="string">"time"</span>:+<span class="keyword">new</span> <span class="built_in">Date</span>()&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">outputTime</span>(<span class="params">T</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> timeStep = &#123;&#125;,</span><br><span class="line">        endTime = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>,len = T.length; i &lt; len; i ++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!T[i]) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        endTime = &#123;&#125;;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> j = i+<span class="number">1</span>; j &lt; len; j++ )&#123;</span><br><span class="line">            <span class="keyword">if</span>(T[j] &amp;&amp; T[i].tag == T[j].tag)&#123;</span><br><span class="line">                endTime.tag = T[j].tag;</span><br><span class="line">                endTime.time = T[j].time;</span><br><span class="line">                T[j] = <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(endTime.time &gt;= <span class="number">0</span> &amp;&amp; endTime.tag)&#123;</span><br><span class="line">            timeStep[endTime.tag] = endTime.time - T[i].time;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> timeStep;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后分析数组之间的间隔就可以分析出执行时间。</p>
<h3 id="u56DB_u3001timeline_u5206_u6790"><a href="#u56DB_u3001timeline_u5206_u6790" class="headerlink" title="四、timeline分析"></a>四、timeline分析</h3><p>浏览器的timeline可以粗粒度的分析浏览器的文件的请求耗时和加载顺序，这里不进行讲述。</p>
<h3 id="u4E94_uFF0Cresource_timing"><a href="#u4E94_uFF0Cresource_timing" class="headerlink" title="五，resource timing"></a>五，resource timing</h3><p>通过资源价值情况来分析前端页面的性能</p>

          
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/13/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><span class="page-number current">14</span><a class="page-number" href="/page/15/">15</a><a class="page-number" href="/page/16/">16</a><a class="extend next" rel="next" href="/page/15/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://avatars2.githubusercontent.com/u/14305708?v=3&s=460"
               alt="terry" />
          <p class="site-author-name" itemprop="name">terry</p>
          <p class="site-description motion-element" itemprop="description">terry yang's blog | java | scala | bi</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">160</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>
          
          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">53</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/yangwei8888" target="_blank">
                  
                    <i class="fa fa-globe"></i> github
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/microsoftgoogles" target="_blank">
                  
                    <i class="fa fa-globe"></i> weibo
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/run-zhi-38" target="_blank">
                  
                    <i class="fa fa-globe"></i> zhihu
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">terry</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  


  



  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'yangwei888';
      var disqus_identifier = 'page/14/index.html';
      var disqus_title = '';
      var disqus_url = '';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
    </script>
  



  
  

  
  


</body>
</html>
